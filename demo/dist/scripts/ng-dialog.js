!function(e,a){"undefined"!=typeof module&&module.exports?(a("undefined"==typeof angular?require("angular"):angular),module.exports="ngDialog"):"function"==typeof define&&define.amd?define(["angular"],a):a(e.angular)}(this,function(e){"use strict";var a=e.module("ngDialog",[]),o=e.element,n=e.isDefined,t=(document.body||document.documentElement).style,l=n(t.animation)||n(t.WebkitAnimation)||n(t.MozAnimation)||n(t.MsAnimation)||n(t.OAnimation),i="animationend webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend",r={html:!1,body:!1},s={},c=[],d=!1,g=!1;return a.provider("ngDialog",function(){var a=this.defaults={className:"ngdialog-theme-default",appendClassName:"",disableAnimation:!1,plain:!1,showClose:!0,closeByDocument:!0,closeByEscape:!0,closeByNavigation:!1,appendTo:!1,preCloseCallback:!1,onOpenCallback:!1,overlay:!0,cache:!0,trapFocus:!0,preserveFocus:!0,ariaAuto:!0,ariaRole:null,ariaLabelledById:null,ariaLabelledBySelector:null,ariaDescribedById:null,ariaDescribedBySelector:null,bodyClassName:"ngdialog-open",width:null,height:null};this.setForceHtmlReload=function(e){r.html=e||!1},this.setForceBodyReload=function(e){r.body=e||!1},this.setDefaults=function(o){e.extend(a,o)},this.setOpenOnePerName=function(e){g=e||!1};var n,t=0,u=0,m={};this.$get=["$document","$templateCache","$compile","$q","$http","$rootScope","$timeout","$window","$controller","$injector",function(f,p,v,y,b,h,D,C,$,A){var E=[],w={onDocumentKeydown:function(e){27===e.keyCode&&B.close("$escape")},activate:function(e){e.data("$ngDialogOptions").trapFocus&&(e.on("keydown",w.onTrapFocusKeydown),E.body.on("keydown",w.onTrapFocusKeydown))},deactivate:function(e){e.off("keydown",w.onTrapFocusKeydown),E.body.off("keydown",w.onTrapFocusKeydown)},deactivateAll:function(a){e.forEach(a,function(a){var o=e.element(a);w.deactivate(o)})},setBodyPadding:function(e){var a=parseInt(E.body.css("padding-right")||0,10);E.body.css("padding-right",a+e+"px"),E.body.data("ng-dialog-original-padding",a),h.$broadcast("ngDialog.setPadding",e)},resetBodyPadding:function(){var e=E.body.data("ng-dialog-original-padding");e?E.body.css("padding-right",e+"px"):E.body.css("padding-right",""),h.$broadcast("ngDialog.setPadding",0)},performCloseDialog:function(e,a){var o=e.data("$ngDialogOptions"),t=e.attr("id"),r=s[t];if(w.deactivate(e),r){if(void 0!==C.Hammer){var g=r.hammerTime;g.off("tap",n),g.destroy&&g.destroy(),delete r.hammerTime}else e.unbind("click");1===u&&E.body.unbind("keydown",w.onDocumentKeydown),e.hasClass("ngdialog-closing")||(u-=1);var f=e.data("$ngDialogPreviousFocus");f&&f.focus&&f.focus(),h.$broadcast("ngDialog.closing",e,a),u=u<0?0:u,l&&!o.disableAnimation?(r.$destroy(),e.unbind(i).bind(i,function(){w.closeDialogElement(e,a)}).addClass("ngdialog-closing")):(r.$destroy(),w.closeDialogElement(e,a)),m[t]&&(m[t].resolve({id:t,value:a,$dialog:e,remainingDialogs:u}),delete m[t]),s[t]&&delete s[t],c.splice(c.indexOf(t),1),c.length||(E.body.unbind("keydown",w.onDocumentKeydown),d=!1),0==u&&(n=void 0)}},closeDialogElement:function(e,a){var o=e.data("$ngDialogOptions");e.remove(),0===u&&(E.html.removeClass(o.bodyClassName),E.body.removeClass(o.bodyClassName),w.resetBodyPadding()),h.$broadcast("ngDialog.closed",e,a)},closeDialog:function(a,o){var n=a.data("$ngDialogPreCloseCallback");if(n&&e.isFunction(n)){var t=n.call(a,o);if(e.isObject(t))t.closePromise?t.closePromise.then(function(){w.performCloseDialog(a,o)},function(){return!1}):t.then(function(){w.performCloseDialog(a,o)},function(){return!1});else{if(!1===t)return!1;w.performCloseDialog(a,o)}}else w.performCloseDialog(a,o)},onTrapFocusKeydown:function(a){var o,n=e.element(a.currentTarget);if(n.hasClass("ngdialog"))o=n;else if(null===(o=w.getActiveDialog()))return;var t=9===a.keyCode,l=!0===a.shiftKey;t&&w.handleTab(o,a,l)},handleTab:function(e,a,o){var n=w.getFocusableElements(e);if(0!==n.length){var t=document.activeElement,l=Array.prototype.indexOf.call(n,t),i=-1===l,r=0===l,s=l===n.length-1,c=!1;o?(i||r)&&(n[n.length-1].focus(),c=!0):(i||s)&&(n[0].focus(),c=!0),c&&(a.preventDefault(),a.stopPropagation())}else document.activeElement&&document.activeElement.blur&&document.activeElement.blur()},autoFocus:function(e){var a=e[0],n=a.querySelector("*[autofocus]");if(null===n||(n.focus(),document.activeElement!==n)){var t=w.getFocusableElements(e);if(t.length>0)t[0].focus();else{var l=w.filterVisibleElements(a.querySelectorAll("h1,h2,h3,h4,h5,h6,p,span"));if(l.length>0){var i=l[0];o(i).attr("tabindex","-1").css("outline","0"),i.focus()}}}},getFocusableElements:function(e){var a=e[0].querySelectorAll("a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), iframe, object, embed, *[tabindex], *[contenteditable]"),o=w.filterTabbableElements(a);return w.filterVisibleElements(o)},filterTabbableElements:function(e){for(var a=[],n=0;n<e.length;n++){var t=e[n];"-1"!==o(t).attr("tabindex")&&a.push(t)}return a},filterVisibleElements:function(e){for(var a=[],o=0;o<e.length;o++){var n=e[o];(n.offsetWidth>0||n.offsetHeight>0)&&a.push(n)}return a},getActiveDialog:function(){var e=document.querySelectorAll(".ngdialog");return 0===e.length?null:o(e[e.length-1])},applyAriaAttributes:function(e,a){if(a.ariaAuto){if(!a.ariaRole){var o=w.getFocusableElements(e).length>0?"dialog":"alertdialog";a.ariaRole=o}a.ariaLabelledBySelector||(a.ariaLabelledBySelector="h1,h2,h3,h4,h5,h6"),a.ariaDescribedBySelector||(a.ariaDescribedBySelector="article,section,p")}a.ariaRole&&e.attr("role",a.ariaRole),w.applyAriaAttribute(e,"aria-labelledby",a.ariaLabelledById,a.ariaLabelledBySelector),w.applyAriaAttribute(e,"aria-describedby",a.ariaDescribedById,a.ariaDescribedBySelector)},applyAriaAttribute:function(e,a,n,t){if(n)e.attr(a,n);else if(t){var l=e.attr("id"),i=e[0].querySelector(t);if(!i)return;var r=l+"-"+a;return o(i).attr("id",r),e.attr(a,r),r}},detectUIRouter:function(){try{return e.module("ui.router"),!0}catch(e){return!1}},getRouterLocationEventName:function(){return w.detectUIRouter()?"$stateChangeStart":"$locationChangeStart"}},B={__PRIVATE__:w,open:function(l){function i(a,o){return(o=o||{}).headers=o.headers||{},e.extend(o.headers,{Accept:"text/html"}),h.$broadcast("ngDialog.templateLoading",a),b.get(a,o).then(function(e){return h.$broadcast("ngDialog.templateLoaded",a),e.data||""})}var r=null;if(l=l||{},!(g&&l.name&&(r=l.name.toLowerCase().replace(/\s/g,"-")+"-dialog",this.isOpen(r)))){var f=e.copy(a),S=++t;r=r||"ngdialog"+S,c.push(r),void 0!==f.data&&(void 0===l.data&&(l.data={}),l.data=e.merge(e.copy(f.data),l.data)),e.extend(f,l);var k;m[r]=k=y.defer();var O;s[r]=O=e.isObject(f.scope)?f.scope.$new():h.$new();var F,T,N,x=e.extend({},f.resolve);return e.forEach(x,function(a,o){x[o]=e.isString(a)?A.get(a):A.invoke(a,null,null,o)}),y.all({template:function(a){return a?e.isString(a)&&f.plain?a:"boolean"!=typeof f.cache||f.cache?i(a,{cache:p}):i(a,{cache:!1}):"Empty template"}(f.template||f.templateUrl),locals:y.all(x)}).then(function(a){var t=a.template,l=a.locals;f.showClose&&(t+='<button aria-label="Dismiss" class="ngdialog-close"></button>');var i=f.overlay?"":" ngdialog-no-overlay";if((F=o('<div id="'+r+'" class="ngdialog'+i+'"></div>')).html(f.overlay?'<div class="ngdialog-overlay"></div><div class="ngdialog-content" role="document">'+t+"</div>":'<div class="ngdialog-content" role="document">'+t+"</div>"),F.data("$ngDialogOptions",f),O.ngDialogId=r,f.data&&e.isString(f.data)){var s=f.data.replace(/^\s*/,"")[0];O.ngDialogData="{"===s||"["===s?e.fromJson(f.data):new String(f.data),O.ngDialogData.ngDialogId=r}else f.data&&e.isObject(f.data)&&(O.ngDialogData=f.data,O.ngDialogData.ngDialogId=r);if(f.className&&F.addClass(f.className),f.appendClassName&&F.addClass(f.appendClassName),f.width&&(N=F[0].querySelector(".ngdialog-content"),e.isString(f.width)?N.style.width=f.width:N.style.width=f.width+"px"),f.height&&(N=F[0].querySelector(".ngdialog-content"),e.isString(f.height)?N.style.height=f.height:N.style.height=f.height+"px"),f.disableAnimation&&F.addClass("ngdialog-disabled-animation"),T=f.appendTo&&e.isString(f.appendTo)?e.element(document.querySelector(f.appendTo)):E.body,w.applyAriaAttributes(F,f),[{name:"$ngDialogPreCloseCallback",value:f.preCloseCallback},{name:"$ngDialogOnOpenCallback",value:f.onOpenCallback}].forEach(function(a){if(a.value){var o;e.isFunction(a.value)?o=a.value:e.isString(a.value)&&O&&(e.isFunction(O[a.value])?o=O[a.value]:O.$parent&&e.isFunction(O.$parent[a.value])?o=O.$parent[a.value]:h&&e.isFunction(h[a.value])&&(o=h[a.value])),o&&F.data(a.name,o)}}),O.closeThisDialog=function(e){w.closeDialog(F,e)},f.controller&&(e.isString(f.controller)||e.isArray(f.controller)||e.isFunction(f.controller))){var c;f.controllerAs&&e.isString(f.controllerAs)&&(c=f.controllerAs);var g=$(f.controller,e.extend(l,{$scope:O,$element:F}),!0,c);f.bindToController&&e.extend(g.instance,{ngDialogId:O.ngDialogId,ngDialogData:O.ngDialogData,closeThisDialog:O.closeThisDialog,confirm:O.confirm}),"function"==typeof g?F.data("$ngDialogControllerController",g()):F.data("$ngDialogControllerController",g)}if(D(function(){var a=document.querySelectorAll(".ngdialog");w.deactivateAll(a),v(F)(O);var o=C.innerWidth-E.body.prop("clientWidth");E.html.addClass(f.bodyClassName),E.body.addClass(f.bodyClassName);var n=o-(C.innerWidth-E.body.prop("clientWidth"));n>0&&w.setBodyPadding(n),T.append(F),w.activate(F),f.trapFocus&&w.autoFocus(F),f.name?h.$broadcast("ngDialog.opened",{dialog:F,name:f.name}):h.$broadcast("ngDialog.opened",F);var t=F.data("$ngDialogOnOpenCallback");t&&e.isFunction(t)&&t.call(F)}),d||(E.body.bind("keydown",w.onDocumentKeydown),d=!0),f.closeByNavigation){var m=w.getRouterLocationEventName();h.$on(m,function(e){!1===w.closeDialog(F)&&e.preventDefault()})}return f.preserveFocus&&F.data("$ngDialogPreviousFocus",document.activeElement),n=function(e){var a=!!f.closeByDocument&&o(e.target).hasClass("ngdialog-overlay"),n=o(e.target).hasClass("ngdialog-close");(a||n)&&B.close(F.attr("id"),n?"$closeButton":"$document")},void 0!==C.Hammer?(O.hammerTime=C.Hammer(F[0])).on("tap",n):F.bind("click",n),u+=1,B}),{id:r,closePromise:k.promise,close:function(e){w.closeDialog(F,e)}}}},openConfirm:function(n){var t=y.defer(),l=e.copy(a);n=n||{},void 0!==l.data&&(void 0===n.data&&(n.data={}),n.data=e.merge(e.copy(l.data),n.data)),e.extend(l,n),l.scope=e.isObject(l.scope)?l.scope.$new():h.$new(),l.scope.confirm=function(e){t.resolve(e);var a=o(document.getElementById(i.id));w.performCloseDialog(a,e)};var i=B.open(l);if(i)return i.closePromise.then(function(e){return e?t.reject(e.value):t.reject()}),t.promise},isOpen:function(e){return o(document.getElementById(e)).length>0},close:function(e,a){var n=o(document.getElementById(e));if(n.length)w.closeDialog(n,a);else if("$escape"===e){var t=c[c.length-1];(n=o(document.getElementById(t))).data("$ngDialogOptions").closeByEscape&&w.closeDialog(n,"$escape")}else B.closeAll(a);return B},closeAll:function(e){for(var a=document.querySelectorAll(".ngdialog"),n=a.length-1;n>=0;n--){var t=a[n];w.closeDialog(o(t),e)}},getOpenDialogs:function(){return c},getDefaults:function(){return a}};return e.forEach(["html","body"],function(e){if(E[e]=f.find(e),r[e]){var a=w.getRouterLocationEventName();h.$on(a,function(){E[e]=f.find(e)})}}),B}]}),a.directive("ngDialog",["ngDialog",function(a){return{restrict:"A",scope:{ngDialogScope:"="},link:function(o,n,t){n.on("click",function(n){n.preventDefault();var l=e.isDefined(o.ngDialogScope)?o.ngDialogScope:"noScope";e.isDefined(t.ngDialogClosePrevious)&&a.close(t.ngDialogClosePrevious);var i=a.getDefaults();a.open({template:t.ngDialog,className:t.ngDialogClass||i.className,appendClassName:t.ngDialogAppendClass,controller:t.ngDialogController,controllerAs:t.ngDialogControllerAs,bindToController:t.ngDialogBindToController,disableAnimation:t.ngDialogDisableAnimation,scope:l,data:t.ngDialogData,showClose:"false"!==t.ngDialogShowClose&&("true"===t.ngDialogShowClose||i.showClose),closeByDocument:"false"!==t.ngDialogCloseByDocument&&("true"===t.ngDialogCloseByDocument||i.closeByDocument),closeByEscape:"false"!==t.ngDialogCloseByEscape&&("true"===t.ngDialogCloseByEscape||i.closeByEscape),overlay:"false"!==t.ngDialogOverlay&&("true"===t.ngDialogOverlay||i.overlay),preCloseCallback:t.ngDialogPreCloseCallback||i.preCloseCallback,onOpenCallback:t.ngDialogOnOpenCallback||i.onOpenCallback,bodyClassName:t.ngDialogBodyClass||i.bodyClassName})})}}}]),a});
//# sourceMappingURL=ng-dialog.js.map
