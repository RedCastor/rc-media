{"version":3,"sources":["../bower_components/ng-file-upload/ng-file-upload.js","../bower_components/ng-file-upload-shim/ng-file-upload-shim.js"],"names":["window","XMLHttpRequest","FileAPI","shouldLoad","prototype","setRequestHeader","orig","header","value","val","this","Function","apply","arguments","ngFileUpload","angular","module","version","service","$http","$q","$timeout","sendHttp","config","notifyProgress","e","deferred","notify","promise","progressFunc","getNotifyEvent","n","_start","resumeSupported","loaded","total","_file","size","type","lengthComputable","target","uploadWithAngular","then","r","_chunkSize","_finished","fileSize","Math","min","_end","upload","resolve","reject","method","headers","_deferred","defer","disableProgress","__setXHR_","xhr","addEventListener","__XHR","xhrFn","resumeSizeUrl","get","resp","resumeSizeResponseReader","data","parseInt","toString","resumeSize","success","fn","response","status","error","progress","abort","pause","origXhrFn","promisesCount","copy","obj","clone","key","hasOwnProperty","isResumeSupported","Blob","slice","isUploadInProgress","rename","file","name","ngfName","jsonBlob","isString","JSON","stringify","blob","_ngfBlob","json","toJson","isFile","flashId","internal","toResumeFile","formData","append","floor","addFieldToFormData","undefined","isDate","toISOString","split","replace","_fileKey","isObject","$$ngfCircularDetection","k","objectKey","length","arrayKey","_isDigested","translateScalars","resumeChunkSize","transformRequest","isArray","push","FormData","fields","formDataAppender","http","ArrayBuffer","defaults","str","search","parseFloat","substring","urlToBlob","url","responseType","arrayBufferView","Uint8Array","matches","match","setDefaults","$parse","$compile","UploadExif","applyExifRotations","files","attr","scope","promises","emptyPromise","forEach","f","i","indexOf","attrGetter","$file","happyPromise","applyExifRotation","fixedFile","splice","all","resizeFile","ngModel","resizeVal","isResizeSupported","p","resizeWithParams","params","pattern","validatePattern","resizeIf","width","height","$width","$height","resize","resizedFile","$error","$errorMessages","$errorParam","message","$ngfValidations","valid","applyModelValidation","handleFile","getAttrWithDefaults","def","attrVal","shouldUpdateOn","modelOptions","updateOn","d","args","rejectPromise","result","updateModel","fileChange","evt","noDelay","update","invalidFiles","newFiles","dupFiles","isSingleModel","$$ngfPrevValidFiles","$$ngfPrevInvalidFiles","invalidFile","$setViewValue","$files","$newFiles","$duplicateFiles","$invalidFiles","$invalidFile","$event","invalidModel","assign","resizeAndUpdate","keep","prevValidFiles","concat","valids","prevInvalidFiles","invalids","options","debounce","change","resizingFiles","validateAfterResize","allNewFiles","validate","validationResult","validsFiles","invalidsFiles","index","$modelValue","v","toArray","equals","f1","f2","$ngfOrigSize","j","isInPrevFiles","removeDuplicates","allowInvalid","validFiles","isExifSupported","directive","Upload","isDelayedClickSupported","ua","m","androidFixMinorVersion","test","linkFileSelect","elem","isInputTypeFile","tagName","toLowerCase","fileChangeAttr","changeFn","fileList","__files_","bindAttrToFileInput","fileElem","label","updateId","attributes","attribute","unwatches","$observe","detectSwipe","touches","changedTouches","originalEvent","initialTouchStartX","clientX","initialTouchStartY","clientY","currentX","currentY","abs","stopPropagation","preventDefault","resetModel","ie10SameFileSelectFix","parentNode","unbind","replaceWith","bind","click","removeAttr","registerModelChangeValidator","$watch","element","css","generatedElems","el","ref","document","body","appendChild","createFileInput","contains","parent","navigator","userAgent","setTimeout","appVersion","$formatters","$on","remove","unwatch","g","ngfFixIE","restrict","require","link","getTagType","linkFileDirective","directiveName","resizeParams","isBackground","constructDataUrl","disallowObjectUrl","dataUrl","src","$ngfDataUrl","$ngfBlobUrl","removeClass","addClass","naturalWidth","clientWidth","naturalHeight","clientHeight","getComputedStyle","style","UploadBase","base64DataUrl","count","urls","ff","$$ngfDataUrlPromise","$$ngfBlobUrlPromise","FileReader","URL","webkitURL","createObjectURL","blobUrls","blobUrlsTotalSize","maxMemory","blobUrlsMaxMemory","maxLength","blobUrlsMaxQueueSize","revokeObjectURL","fileReader","onload","onerror","readAsDataURL","$compileProvider","imgSrcSanitizationWhitelist","aHrefSanitizationWhitelist","filter","UploadDataUrl","$sce","trustedUrl","trustAsResourceUrl","$ngfDataUrlFilterInProgress","globStringToRegex","regexp","excludes","RegExp","markModelAsDirty","$dirty","$setDirty","len","exclude","ratioToFloat","xIndex","filesArray","validation","$setValidity","getValidationAttr","validationName","dName","toUpperCase","substr","prevLength","validateSync","ignoredErrors","runAllValidation","validateAsync","asyncFn","resolveResult","resolveInternal","imageDimensions","mediaDuration","$duration","deffer","values","isValid","totalSize","$ngfWidth","$ngfHeight","$ngfDimensionPromise","img","checkLoadErrorInCaseOfNoCallback","secondsCounter","on","getElementsByTagName","$ngfDuration","$ngfDurationPromise","duration","checkLoadError","UploadValidate","calculateAspectRatioFit","srcWidth","srcHeight","maxWidth","maxHeight","centerCrop","ratio","max","marginX","marginY","imagen","quality","canvasElement","createElement","imageElement","setAttribute","imgWidth","imgHeight","removeChild","ratioFloat","dimensions","getContext","drawImage","toDataURL","dataUrltoBlob","dataurl","origSize","arr","mime","bstr","atob","u8arr","charCodeAt","Object","defineProperty","$ngfName","set","configurable","restoreExif","linkDrop","$window","isDisabled","extractFilesAndUpdateModel","source","updateOnType","html","getData","extractFiles","items","extractFilesFromHtml","calculateDragOverClass","callback","dClass","delay","dragOverDelay","accept","dataTransfer","allowDir","multiple","traverseFileTree","entry","path","isDirectory","includeDir","dirReader","createReader","entries","readEntries","results","Array","call","maxFiles","maxTotalSize","Number","MAX_VALUE","location","protocol","webkitGetAsEntry","getAsFile","item","available","dropAvailable","actualDragOverClass","leaveTimeout","b","effectAllowed","dropEffect","cancel","clazz","$isDragging","$class","clipboardData","metaKey","ctrlKey","div","model","UploadResize","applyTransform","ctx","orientation","transform","arrayBufferToBase64","buffer","binary","bytes","byteLength","String","fromCharCode","btoa","readAsArrayBuffer","readOrientation","reader","slicedFile","view","DataView","getUint16","offset","marker","getUint32","little","tags","setUint16","fixedArrayBuffer","canvas","resized","ExifRestorer","KEY_STR","encode64","input","chr1","chr2","enc1","enc2","enc3","output","chr3","enc4","isNaN","charAt","restore","origFileBase64","resizedFileBase64","rawImage","decode64","segments","slice2Segments","image","exifManipulation","exifArray","getExifArray","newImageArray","insertExif","seg","x","imageData","buf","separatePoint","mae","ato","array","rawImageArray","head","endPoint","exec","console","log","patchXHR","fnName","newFn","redefineProp","prop","forceLoad","initializeUploadListener","__listeners","origAddEventListener","t","__url","__origError","h","__fileApiXHR","getResponseHeader","getAllResponseHeaders","__requestHeaders","__isFileAPIShim","jsonp","cache","complete","err","fileApiXHR","__completed","load","__loaded","__total","loadend","statusText","responseText","onreadystatechange","_this","noContentTimeout","hasFlash","__isFileAPIBlobShim","ActiveXObject","mimeTypes","getOffset","left","top","jQuery","offsetParent","offsetLeft","scrollLeft","offsetTop","scrollTop","html5","jsUrl","basePath","script","allScripts","jsPath","staticPath","fileApiChangeFn","offsetWidth","offsetHeight","getFiles","disableFileInput","disable","loadStarted","listeners","removeEventListener","dispatchEvent","list","onabort","onloadstart","onloadend","onprogress","constructEvent","listener","readAsText"],"mappings":"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","file":"ng-file-upload.js","sourcesContent":["/**!\n * AngularJS file upload directives and services. Supoorts: file upload/drop/paste, resume, cancel/abort,\n * progress, resize, thumbnail, preview, validation and CORS\n * @author  Danial  <danial.farid@gmail.com>\n * @version 12.2.13\n */\n\nif (window.XMLHttpRequest && !(window.FileAPI && FileAPI.shouldLoad)) {\n  window.XMLHttpRequest.prototype.setRequestHeader = (function (orig) {\n    return function (header, value) {\n      if (header === '__setXHR_') {\n        var val = value(this);\n        // fix for angular < 1.2.0\n        if (val instanceof Function) {\n          val(this);\n        }\n      } else {\n        orig.apply(this, arguments);\n      }\n    };\n  })(window.XMLHttpRequest.prototype.setRequestHeader);\n}\n\nvar ngFileUpload = angular.module('ngFileUpload', []);\n\nngFileUpload.version = '12.2.13';\n\nngFileUpload.service('UploadBase', ['$http', '$q', '$timeout', function ($http, $q, $timeout) {\n  var upload = this;\n  upload.promisesCount = 0;\n\n  this.isResumeSupported = function () {\n    return window.Blob && window.Blob.prototype.slice;\n  };\n\n  var resumeSupported = this.isResumeSupported();\n\n  function sendHttp(config) {\n    config.method = config.method || 'POST';\n    config.headers = config.headers || {};\n\n    var deferred = config._deferred = config._deferred || $q.defer();\n    var promise = deferred.promise;\n\n    function notifyProgress(e) {\n      if (deferred.notify) {\n        deferred.notify(e);\n      }\n      if (promise.progressFunc) {\n        $timeout(function () {\n          promise.progressFunc(e);\n        });\n      }\n    }\n\n    function getNotifyEvent(n) {\n      if (config._start != null && resumeSupported) {\n        return {\n          loaded: n.loaded + config._start,\n          total: (config._file && config._file.size) || n.total,\n          type: n.type, config: config,\n          lengthComputable: true, target: n.target\n        };\n      } else {\n        return n;\n      }\n    }\n\n    if (!config.disableProgress) {\n      config.headers.__setXHR_ = function () {\n        return function (xhr) {\n          if (!xhr || !xhr.upload || !xhr.upload.addEventListener) return;\n          config.__XHR = xhr;\n          if (config.xhrFn) config.xhrFn(xhr);\n          xhr.upload.addEventListener('progress', function (e) {\n            e.config = config;\n            notifyProgress(getNotifyEvent(e));\n          }, false);\n          //fix for firefox not firing upload progress end, also IE8-9\n          xhr.upload.addEventListener('load', function (e) {\n            if (e.lengthComputable) {\n              e.config = config;\n              notifyProgress(getNotifyEvent(e));\n            }\n          }, false);\n        };\n      };\n    }\n\n    function uploadWithAngular() {\n      $http(config).then(function (r) {\n          if (resumeSupported && config._chunkSize && !config._finished && config._file) {\n            var fileSize = config._file && config._file.size || 0;\n            notifyProgress({\n                loaded: Math.min(config._end, fileSize),\n                total: fileSize,\n                config: config,\n                type: 'progress'\n              }\n            );\n            upload.upload(config, true);\n          } else {\n            if (config._finished) delete config._finished;\n            deferred.resolve(r);\n          }\n        }, function (e) {\n          deferred.reject(e);\n        }, function (n) {\n          deferred.notify(n);\n        }\n      );\n    }\n\n    if (!resumeSupported) {\n      uploadWithAngular();\n    } else if (config._chunkSize && config._end && !config._finished) {\n      config._start = config._end;\n      config._end += config._chunkSize;\n      uploadWithAngular();\n    } else if (config.resumeSizeUrl) {\n      $http.get(config.resumeSizeUrl).then(function (resp) {\n        if (config.resumeSizeResponseReader) {\n          config._start = config.resumeSizeResponseReader(resp.data);\n        } else {\n          config._start = parseInt((resp.data.size == null ? resp.data : resp.data.size).toString());\n        }\n        if (config._chunkSize) {\n          config._end = config._start + config._chunkSize;\n        }\n        uploadWithAngular();\n      }, function (e) {\n        throw e;\n      });\n    } else if (config.resumeSize) {\n      config.resumeSize().then(function (size) {\n        config._start = size;\n        if (config._chunkSize) {\n          config._end = config._start + config._chunkSize;\n        }\n        uploadWithAngular();\n      }, function (e) {\n        throw e;\n      });\n    } else {\n      if (config._chunkSize) {\n        config._start = 0;\n        config._end = config._start + config._chunkSize;\n      }\n      uploadWithAngular();\n    }\n\n\n    promise.success = function (fn) {\n      promise.then(function (response) {\n        fn(response.data, response.status, response.headers, config);\n      });\n      return promise;\n    };\n\n    promise.error = function (fn) {\n      promise.then(null, function (response) {\n        fn(response.data, response.status, response.headers, config);\n      });\n      return promise;\n    };\n\n    promise.progress = function (fn) {\n      promise.progressFunc = fn;\n      promise.then(null, null, function (n) {\n        fn(n);\n      });\n      return promise;\n    };\n    promise.abort = promise.pause = function () {\n      if (config.__XHR) {\n        $timeout(function () {\n          config.__XHR.abort();\n        });\n      }\n      return promise;\n    };\n    promise.xhr = function (fn) {\n      config.xhrFn = (function (origXhrFn) {\n        return function () {\n          if (origXhrFn) origXhrFn.apply(promise, arguments);\n          fn.apply(promise, arguments);\n        };\n      })(config.xhrFn);\n      return promise;\n    };\n\n    upload.promisesCount++;\n    if (promise['finally'] && promise['finally'] instanceof Function) {\n      promise['finally'](function () {\n        upload.promisesCount--;\n      });\n    }\n    return promise;\n  }\n\n  this.isUploadInProgress = function () {\n    return upload.promisesCount > 0;\n  };\n\n  this.rename = function (file, name) {\n    file.ngfName = name;\n    return file;\n  };\n\n  this.jsonBlob = function (val) {\n    if (val != null && !angular.isString(val)) {\n      val = JSON.stringify(val);\n    }\n    var blob = new window.Blob([val], {type: 'application/json'});\n    blob._ngfBlob = true;\n    return blob;\n  };\n\n  this.json = function (val) {\n    return angular.toJson(val);\n  };\n\n  function copy(obj) {\n    var clone = {};\n    for (var key in obj) {\n      if (obj.hasOwnProperty(key)) {\n        clone[key] = obj[key];\n      }\n    }\n    return clone;\n  }\n\n  this.isFile = function (file) {\n    return file != null && (file instanceof window.Blob || (file.flashId && file.name && file.size));\n  };\n\n  this.upload = function (config, internal) {\n    function toResumeFile(file, formData) {\n      if (file._ngfBlob) return file;\n      config._file = config._file || file;\n      if (config._start != null && resumeSupported) {\n        if (config._end && config._end >= file.size) {\n          config._finished = true;\n          config._end = file.size;\n        }\n        var slice = file.slice(config._start, config._end || file.size);\n        slice.name = file.name;\n        slice.ngfName = file.ngfName;\n        if (config._chunkSize) {\n          formData.append('_chunkSize', config._chunkSize);\n          formData.append('_currentChunkSize', config._end - config._start);\n          formData.append('_chunkNumber', Math.floor(config._start / config._chunkSize));\n          formData.append('_totalSize', config._file.size);\n        }\n        return slice;\n      }\n      return file;\n    }\n\n    function addFieldToFormData(formData, val, key) {\n      if (val !== undefined) {\n        if (angular.isDate(val)) {\n          val = val.toISOString();\n        }\n        if (angular.isString(val)) {\n          formData.append(key, val);\n        } else if (upload.isFile(val)) {\n          var file = toResumeFile(val, formData);\n          var split = key.split(',');\n          if (split[1]) {\n            file.ngfName = split[1].replace(/^\\s+|\\s+$/g, '');\n            key = split[0];\n          }\n          config._fileKey = config._fileKey || key;\n          formData.append(key, file, file.ngfName || file.name);\n        } else {\n          if (angular.isObject(val)) {\n            if (val.$$ngfCircularDetection) throw 'ngFileUpload: Circular reference in config.data. Make sure specified data for Upload.upload() has no circular reference: ' + key;\n\n            val.$$ngfCircularDetection = true;\n            try {\n              for (var k in val) {\n                if (val.hasOwnProperty(k) && k !== '$$ngfCircularDetection') {\n                  var objectKey = config.objectKey == null ? '[i]' : config.objectKey;\n                  if (val.length && parseInt(k) > -1) {\n                    objectKey = config.arrayKey == null ? objectKey : config.arrayKey;\n                  }\n                  addFieldToFormData(formData, val[k], key + objectKey.replace(/[ik]/g, k));\n                }\n              }\n            } finally {\n              delete val.$$ngfCircularDetection;\n            }\n          } else {\n            formData.append(key, val);\n          }\n        }\n      }\n    }\n\n    function digestConfig() {\n      config._chunkSize = upload.translateScalars(config.resumeChunkSize);\n      config._chunkSize = config._chunkSize ? parseInt(config._chunkSize.toString()) : null;\n\n      config.headers = config.headers || {};\n      config.headers['Content-Type'] = undefined;\n      config.transformRequest = config.transformRequest ?\n        (angular.isArray(config.transformRequest) ?\n          config.transformRequest : [config.transformRequest]) : [];\n      config.transformRequest.push(function (data) {\n        var formData = new window.FormData(), key;\n        data = data || config.fields || {};\n        if (config.file) {\n          data.file = config.file;\n        }\n        for (key in data) {\n          if (data.hasOwnProperty(key)) {\n            var val = data[key];\n            if (config.formDataAppender) {\n              config.formDataAppender(formData, key, val);\n            } else {\n              addFieldToFormData(formData, val, key);\n            }\n          }\n        }\n\n        return formData;\n      });\n    }\n\n    if (!internal) config = copy(config);\n    if (!config._isDigested) {\n      config._isDigested = true;\n      digestConfig();\n    }\n\n    return sendHttp(config);\n  };\n\n  this.http = function (config) {\n    config = copy(config);\n    config.transformRequest = config.transformRequest || function (data) {\n        if ((window.ArrayBuffer && data instanceof window.ArrayBuffer) || data instanceof window.Blob) {\n          return data;\n        }\n        return $http.defaults.transformRequest[0].apply(this, arguments);\n      };\n    config._chunkSize = upload.translateScalars(config.resumeChunkSize);\n    config._chunkSize = config._chunkSize ? parseInt(config._chunkSize.toString()) : null;\n\n    return sendHttp(config);\n  };\n\n  this.translateScalars = function (str) {\n    if (angular.isString(str)) {\n      if (str.search(/kb/i) === str.length - 2) {\n        return parseFloat(str.substring(0, str.length - 2) * 1024);\n      } else if (str.search(/mb/i) === str.length - 2) {\n        return parseFloat(str.substring(0, str.length - 2) * 1048576);\n      } else if (str.search(/gb/i) === str.length - 2) {\n        return parseFloat(str.substring(0, str.length - 2) * 1073741824);\n      } else if (str.search(/b/i) === str.length - 1) {\n        return parseFloat(str.substring(0, str.length - 1));\n      } else if (str.search(/s/i) === str.length - 1) {\n        return parseFloat(str.substring(0, str.length - 1));\n      } else if (str.search(/m/i) === str.length - 1) {\n        return parseFloat(str.substring(0, str.length - 1) * 60);\n      } else if (str.search(/h/i) === str.length - 1) {\n        return parseFloat(str.substring(0, str.length - 1) * 3600);\n      }\n    }\n    return str;\n  };\n\n  this.urlToBlob = function(url) {\n    var defer = $q.defer();\n    $http({url: url, method: 'get', responseType: 'arraybuffer'}).then(function (resp) {\n      var arrayBufferView = new Uint8Array(resp.data);\n      var type = resp.headers('content-type') || 'image/WebP';\n      var blob = new window.Blob([arrayBufferView], {type: type});\n      var matches = url.match(/.*\\/(.+?)(\\?.*)?$/);\n      if (matches.length > 1) {\n        blob.name = matches[1];\n      }\n      defer.resolve(blob);\n    }, function (e) {\n      defer.reject(e);\n    });\n    return defer.promise;\n  };\n\n  this.setDefaults = function (defaults) {\n    this.defaults = defaults || {};\n  };\n\n  this.defaults = {};\n  this.version = ngFileUpload.version;\n}\n\n]);\n\nngFileUpload.service('Upload', ['$parse', '$timeout', '$compile', '$q', 'UploadExif', function ($parse, $timeout, $compile, $q, UploadExif) {\n  var upload = UploadExif;\n  upload.getAttrWithDefaults = function (attr, name) {\n    if (attr[name] != null) return attr[name];\n    var def = upload.defaults[name];\n    return (def == null ? def : (angular.isString(def) ? def : JSON.stringify(def)));\n  };\n\n  upload.attrGetter = function (name, attr, scope, params) {\n    var attrVal = this.getAttrWithDefaults(attr, name);\n    if (scope) {\n      try {\n        if (params) {\n          return $parse(attrVal)(scope, params);\n        } else {\n          return $parse(attrVal)(scope);\n        }\n      } catch (e) {\n        // hangle string value without single qoute\n        if (name.search(/min|max|pattern/i)) {\n          return attrVal;\n        } else {\n          throw e;\n        }\n      }\n    } else {\n      return attrVal;\n    }\n  };\n\n  upload.shouldUpdateOn = function (type, attr, scope) {\n    var modelOptions = upload.attrGetter('ngfModelOptions', attr, scope);\n    if (modelOptions && modelOptions.updateOn) {\n      return modelOptions.updateOn.split(' ').indexOf(type) > -1;\n    }\n    return true;\n  };\n\n  upload.emptyPromise = function () {\n    var d = $q.defer();\n    var args = arguments;\n    $timeout(function () {\n      d.resolve.apply(d, args);\n    });\n    return d.promise;\n  };\n\n  upload.rejectPromise = function () {\n    var d = $q.defer();\n    var args = arguments;\n    $timeout(function () {\n      d.reject.apply(d, args);\n    });\n    return d.promise;\n  };\n\n  upload.happyPromise = function (promise, data) {\n    var d = $q.defer();\n    promise.then(function (result) {\n      d.resolve(result);\n    }, function (error) {\n      $timeout(function () {\n        throw error;\n      });\n      d.resolve(data);\n    });\n    return d.promise;\n  };\n\n  function applyExifRotations(files, attr, scope) {\n    var promises = [upload.emptyPromise()];\n    angular.forEach(files, function (f, i) {\n      if (f.type.indexOf('image/jpeg') === 0 && upload.attrGetter('ngfFixOrientation', attr, scope, {$file: f})) {\n        promises.push(upload.happyPromise(upload.applyExifRotation(f), f).then(function (fixedFile) {\n          files.splice(i, 1, fixedFile);\n        }));\n      }\n    });\n    return $q.all(promises);\n  }\n\n  function resizeFile(files, attr, scope, ngModel) {\n    var resizeVal = upload.attrGetter('ngfResize', attr, scope);\n    if (!resizeVal || !upload.isResizeSupported() || !files.length) return upload.emptyPromise();\n    if (resizeVal instanceof Function) {\n      var defer = $q.defer();\n      return resizeVal(files).then(function (p) {\n        resizeWithParams(p, files, attr, scope, ngModel).then(function (r) {\n          defer.resolve(r);\n        }, function (e) {\n          defer.reject(e);\n        });\n      }, function (e) {\n        defer.reject(e);\n      });\n    } else {\n      return resizeWithParams(resizeVal, files, attr, scope, ngModel);\n    }\n  }\n\n  function resizeWithParams(params, files, attr, scope, ngModel) {\n    var promises = [upload.emptyPromise()];\n\n    function handleFile(f, i) {\n      if (f.type.indexOf('image') === 0) {\n        if (params.pattern && !upload.validatePattern(f, params.pattern)) return;\n        params.resizeIf = function (width, height) {\n          return upload.attrGetter('ngfResizeIf', attr, scope,\n            {$width: width, $height: height, $file: f});\n        };\n        var promise = upload.resize(f, params);\n        promises.push(promise);\n        promise.then(function (resizedFile) {\n          files.splice(i, 1, resizedFile);\n        }, function (e) {\n          f.$error = 'resize';\n          (f.$errorMessages = (f.$errorMessages || {})).resize = true;\n          f.$errorParam = (e ? (e.message ? e.message : e) + ': ' : '') + (f && f.name);\n          ngModel.$ngfValidations.push({name: 'resize', valid: false});\n          upload.applyModelValidation(ngModel, files);\n        });\n      }\n    }\n\n    for (var i = 0; i < files.length; i++) {\n      handleFile(files[i], i);\n    }\n    return $q.all(promises);\n  }\n\n  upload.updateModel = function (ngModel, attr, scope, fileChange, files, evt, noDelay) {\n    function update(files, invalidFiles, newFiles, dupFiles, isSingleModel) {\n      attr.$$ngfPrevValidFiles = files;\n      attr.$$ngfPrevInvalidFiles = invalidFiles;\n      var file = files && files.length ? files[0] : null;\n      var invalidFile = invalidFiles && invalidFiles.length ? invalidFiles[0] : null;\n\n      if (ngModel) {\n        upload.applyModelValidation(ngModel, files);\n        ngModel.$setViewValue(isSingleModel ? file : files);\n      }\n\n      if (fileChange) {\n        $parse(fileChange)(scope, {\n          $files: files,\n          $file: file,\n          $newFiles: newFiles,\n          $duplicateFiles: dupFiles,\n          $invalidFiles: invalidFiles,\n          $invalidFile: invalidFile,\n          $event: evt\n        });\n      }\n\n      var invalidModel = upload.attrGetter('ngfModelInvalid', attr);\n      if (invalidModel) {\n        $timeout(function () {\n          $parse(invalidModel).assign(scope, isSingleModel ? invalidFile : invalidFiles);\n        });\n      }\n      $timeout(function () {\n        // scope apply changes\n      });\n    }\n\n    var allNewFiles, dupFiles = [], prevValidFiles, prevInvalidFiles,\n      invalids = [], valids = [];\n\n    function removeDuplicates() {\n      function equals(f1, f2) {\n        return f1.name === f2.name && (f1.$ngfOrigSize || f1.size) === (f2.$ngfOrigSize || f2.size) &&\n          f1.type === f2.type;\n      }\n\n      function isInPrevFiles(f) {\n        var j;\n        for (j = 0; j < prevValidFiles.length; j++) {\n          if (equals(f, prevValidFiles[j])) {\n            return true;\n          }\n        }\n        for (j = 0; j < prevInvalidFiles.length; j++) {\n          if (equals(f, prevInvalidFiles[j])) {\n            return true;\n          }\n        }\n        return false;\n      }\n\n      if (files) {\n        allNewFiles = [];\n        dupFiles = [];\n        for (var i = 0; i < files.length; i++) {\n          if (isInPrevFiles(files[i])) {\n            dupFiles.push(files[i]);\n          } else {\n            allNewFiles.push(files[i]);\n          }\n        }\n      }\n    }\n\n    function toArray(v) {\n      return angular.isArray(v) ? v : [v];\n    }\n\n    function resizeAndUpdate() {\n      function updateModel() {\n        $timeout(function () {\n          update(keep ? prevValidFiles.concat(valids) : valids,\n            keep ? prevInvalidFiles.concat(invalids) : invalids,\n            files, dupFiles, isSingleModel);\n        }, options && options.debounce ? options.debounce.change || options.debounce : 0);\n      }\n\n      var resizingFiles = validateAfterResize ? allNewFiles : valids;\n      resizeFile(resizingFiles, attr, scope, ngModel).then(function () {\n        if (validateAfterResize) {\n          upload.validate(allNewFiles, keep ? prevValidFiles.length : 0, ngModel, attr, scope)\n            .then(function (validationResult) {\n              valids = validationResult.validsFiles;\n              invalids = validationResult.invalidsFiles;\n              updateModel();\n            });\n        } else {\n          updateModel();\n        }\n      }, function () {\n        for (var i = 0; i < resizingFiles.length; i++) {\n          var f = resizingFiles[i];\n          if (f.$error === 'resize') {\n            var index = valids.indexOf(f);\n            if (index > -1) {\n              valids.splice(index, 1);\n              invalids.push(f);\n            }\n            updateModel();\n          }\n        }\n      });\n    }\n\n    prevValidFiles = attr.$$ngfPrevValidFiles || [];\n    prevInvalidFiles = attr.$$ngfPrevInvalidFiles || [];\n    if (ngModel && ngModel.$modelValue) {\n      prevValidFiles = toArray(ngModel.$modelValue);\n    }\n\n    var keep = upload.attrGetter('ngfKeep', attr, scope);\n    allNewFiles = (files || []).slice(0);\n    if (keep === 'distinct' || upload.attrGetter('ngfKeepDistinct', attr, scope) === true) {\n      removeDuplicates(attr, scope);\n    }\n\n    var isSingleModel = !keep && !upload.attrGetter('ngfMultiple', attr, scope) && !upload.attrGetter('multiple', attr);\n\n    if (keep && !allNewFiles.length) return;\n\n    upload.attrGetter('ngfBeforeModelChange', attr, scope, {\n      $files: files,\n      $file: files && files.length ? files[0] : null,\n      $newFiles: allNewFiles,\n      $duplicateFiles: dupFiles,\n      $event: evt\n    });\n\n    var validateAfterResize = upload.attrGetter('ngfValidateAfterResize', attr, scope);\n\n    var options = upload.attrGetter('ngfModelOptions', attr, scope);\n    upload.validate(allNewFiles, keep ? prevValidFiles.length : 0, ngModel, attr, scope)\n      .then(function (validationResult) {\n      if (noDelay) {\n        update(allNewFiles, [], files, dupFiles, isSingleModel);\n      } else {\n        if ((!options || !options.allowInvalid) && !validateAfterResize) {\n          valids = validationResult.validFiles;\n          invalids = validationResult.invalidFiles;\n        } else {\n          valids = allNewFiles;\n        }\n        if (upload.attrGetter('ngfFixOrientation', attr, scope) && upload.isExifSupported()) {\n          applyExifRotations(valids, attr, scope).then(function () {\n            resizeAndUpdate();\n          });\n        } else {\n          resizeAndUpdate();\n        }\n      }\n    });\n  };\n\n  return upload;\n}]);\n\nngFileUpload.directive('ngfSelect', ['$parse', '$timeout', '$compile', 'Upload', function ($parse, $timeout, $compile, Upload) {\n  var generatedElems = [];\n\n  function isDelayedClickSupported(ua) {\n    // fix for android native browser < 4.4 and safari windows\n    var m = ua.match(/Android[^\\d]*(\\d+)\\.(\\d+)/);\n    if (m && m.length > 2) {\n      var v = Upload.defaults.androidFixMinorVersion || 4;\n      return parseInt(m[1]) < 4 || (parseInt(m[1]) === v && parseInt(m[2]) < v);\n    }\n\n    // safari on windows\n    return ua.indexOf('Chrome') === -1 && /.*Windows.*Safari.*/.test(ua);\n  }\n\n  function linkFileSelect(scope, elem, attr, ngModel, $parse, $timeout, $compile, upload) {\n    /** @namespace attr.ngfSelect */\n    /** @namespace attr.ngfChange */\n    /** @namespace attr.ngModel */\n    /** @namespace attr.ngfModelOptions */\n    /** @namespace attr.ngfMultiple */\n    /** @namespace attr.ngfCapture */\n    /** @namespace attr.ngfValidate */\n    /** @namespace attr.ngfKeep */\n    var attrGetter = function (name, scope) {\n      return upload.attrGetter(name, attr, scope);\n    };\n\n    function isInputTypeFile() {\n      return elem[0].tagName.toLowerCase() === 'input' && attr.type && attr.type.toLowerCase() === 'file';\n    }\n\n    function fileChangeAttr() {\n      return attrGetter('ngfChange') || attrGetter('ngfSelect');\n    }\n\n    function changeFn(evt) {\n      if (upload.shouldUpdateOn('change', attr, scope)) {\n        var fileList = evt.__files_ || (evt.target && evt.target.files), files = [];\n        /* Handle duplicate call in  IE11 */\n        if (!fileList) return;\n        for (var i = 0; i < fileList.length; i++) {\n          files.push(fileList[i]);\n        }\n        upload.updateModel(ngModel, attr, scope, fileChangeAttr(),\n          files.length ? files : null, evt);\n      }\n    }\n\n    upload.registerModelChangeValidator(ngModel, attr, scope);\n\n    var unwatches = [];\n    if (attrGetter('ngfMultiple')) {\n      unwatches.push(scope.$watch(attrGetter('ngfMultiple'), function () {\n        fileElem.attr('multiple', attrGetter('ngfMultiple', scope));\n      }));\n    }\n    if (attrGetter('ngfCapture')) {\n      unwatches.push(scope.$watch(attrGetter('ngfCapture'), function () {\n        fileElem.attr('capture', attrGetter('ngfCapture', scope));\n      }));\n    }\n    if (attrGetter('ngfAccept')) {\n      unwatches.push(scope.$watch(attrGetter('ngfAccept'), function () {\n        fileElem.attr('accept', attrGetter('ngfAccept', scope));\n      }));\n    }\n    unwatches.push(attr.$observe('accept', function () {\n      fileElem.attr('accept', attrGetter('accept'));\n    }));\n    function bindAttrToFileInput(fileElem, label) {\n      function updateId(val) {\n        fileElem.attr('id', 'ngf-' + val);\n        label.attr('id', 'ngf-label-' + val);\n      }\n\n      for (var i = 0; i < elem[0].attributes.length; i++) {\n        var attribute = elem[0].attributes[i];\n        if (attribute.name !== 'type' && attribute.name !== 'class' && attribute.name !== 'style') {\n          if (attribute.name === 'id') {\n            updateId(attribute.value);\n            unwatches.push(attr.$observe('id', updateId));\n          } else {\n            fileElem.attr(attribute.name, (!attribute.value && (attribute.name === 'required' ||\n            attribute.name === 'multiple')) ? attribute.name : attribute.value);\n          }\n        }\n      }\n    }\n\n    function createFileInput() {\n      if (isInputTypeFile()) {\n        return elem;\n      }\n\n      var fileElem = angular.element('<input type=\"file\">');\n\n      var label = angular.element('<label>upload</label>');\n      label.css('visibility', 'hidden').css('position', 'absolute').css('overflow', 'hidden')\n        .css('width', '0px').css('height', '0px').css('border', 'none')\n        .css('margin', '0px').css('padding', '0px').attr('tabindex', '-1');\n      bindAttrToFileInput(fileElem, label);\n\n      generatedElems.push({el: elem, ref: label});\n\n      document.body.appendChild(label.append(fileElem)[0]);\n\n      return fileElem;\n    }\n\n    function clickHandler(evt) {\n      if (elem.attr('disabled')) return false;\n      if (attrGetter('ngfSelectDisabled', scope)) return;\n\n      var r = detectSwipe(evt);\n      // prevent the click if it is a swipe\n      if (r != null) return r;\n\n      resetModel(evt);\n\n      // fix for md when the element is removed from the DOM and added back #460\n      try {\n        if (!isInputTypeFile() && !document.body.contains(fileElem[0])) {\n          generatedElems.push({el: elem, ref: fileElem.parent()});\n          document.body.appendChild(fileElem.parent()[0]);\n          fileElem.bind('change', changeFn);\n        }\n      } catch (e) {/*ignore*/\n      }\n\n      if (isDelayedClickSupported(navigator.userAgent)) {\n        setTimeout(function () {\n          fileElem[0].click();\n        }, 0);\n      } else {\n        fileElem[0].click();\n      }\n\n      return false;\n    }\n\n\n    var initialTouchStartY = 0;\n    var initialTouchStartX = 0;\n\n    function detectSwipe(evt) {\n      var touches = evt.changedTouches || (evt.originalEvent && evt.originalEvent.changedTouches);\n      if (touches) {\n        if (evt.type === 'touchstart') {\n          initialTouchStartX = touches[0].clientX;\n          initialTouchStartY = touches[0].clientY;\n          return true; // don't block event default\n        } else {\n          // prevent scroll from triggering event\n          if (evt.type === 'touchend') {\n            var currentX = touches[0].clientX;\n            var currentY = touches[0].clientY;\n            if ((Math.abs(currentX - initialTouchStartX) > 20) ||\n              (Math.abs(currentY - initialTouchStartY) > 20)) {\n              evt.stopPropagation();\n              evt.preventDefault();\n              return false;\n            }\n          }\n          return true;\n        }\n      }\n    }\n\n    var fileElem = elem;\n\n    function resetModel(evt) {\n      if (upload.shouldUpdateOn('click', attr, scope) && fileElem.val()) {\n        fileElem.val(null);\n        upload.updateModel(ngModel, attr, scope, fileChangeAttr(), null, evt, true);\n      }\n    }\n\n    if (!isInputTypeFile()) {\n      fileElem = createFileInput();\n    }\n    fileElem.bind('change', changeFn);\n\n    if (!isInputTypeFile()) {\n      elem.bind('click touchstart touchend', clickHandler);\n    } else {\n      elem.bind('click', resetModel);\n    }\n\n    function ie10SameFileSelectFix(evt) {\n      if (fileElem && !fileElem.attr('__ngf_ie10_Fix_')) {\n        if (!fileElem[0].parentNode) {\n          fileElem = null;\n          return;\n        }\n        evt.preventDefault();\n        evt.stopPropagation();\n        fileElem.unbind('click');\n        var clone = fileElem.clone();\n        fileElem.replaceWith(clone);\n        fileElem = clone;\n        fileElem.attr('__ngf_ie10_Fix_', 'true');\n        fileElem.bind('change', changeFn);\n        fileElem.bind('click', ie10SameFileSelectFix);\n        fileElem[0].click();\n        return false;\n      } else {\n        fileElem.removeAttr('__ngf_ie10_Fix_');\n      }\n    }\n\n    if (navigator.appVersion.indexOf('MSIE 10') !== -1) {\n      fileElem.bind('click', ie10SameFileSelectFix);\n    }\n\n    if (ngModel) ngModel.$formatters.push(function (val) {\n      if (val == null || val.length === 0) {\n        if (fileElem.val()) {\n          fileElem.val(null);\n        }\n      }\n      return val;\n    });\n\n    scope.$on('$destroy', function () {\n      if (!isInputTypeFile()) fileElem.parent().remove();\n      angular.forEach(unwatches, function (unwatch) {\n        unwatch();\n      });\n    });\n\n    $timeout(function () {\n      for (var i = 0; i < generatedElems.length; i++) {\n        var g = generatedElems[i];\n        if (!document.body.contains(g.el[0])) {\n          generatedElems.splice(i, 1);\n          g.ref.remove();\n        }\n      }\n    });\n\n    if (window.FileAPI && window.FileAPI.ngfFixIE) {\n      window.FileAPI.ngfFixIE(elem, fileElem, changeFn);\n    }\n  }\n\n  return {\n    restrict: 'AEC',\n    require: '?ngModel',\n    link: function (scope, elem, attr, ngModel) {\n      linkFileSelect(scope, elem, attr, ngModel, $parse, $timeout, $compile, Upload);\n    }\n  };\n}]);\n\n(function () {\n\n  ngFileUpload.service('UploadDataUrl', ['UploadBase', '$timeout', '$q', function (UploadBase, $timeout, $q) {\n    var upload = UploadBase;\n    upload.base64DataUrl = function (file) {\n      if (angular.isArray(file)) {\n        var d = $q.defer(), count = 0;\n        angular.forEach(file, function (f) {\n          upload.dataUrl(f, true)['finally'](function () {\n            count++;\n            if (count === file.length) {\n              var urls = [];\n              angular.forEach(file, function (ff) {\n                urls.push(ff.$ngfDataUrl);\n              });\n              d.resolve(urls, file);\n            }\n          });\n        });\n        return d.promise;\n      } else {\n        return upload.dataUrl(file, true);\n      }\n    };\n    upload.dataUrl = function (file, disallowObjectUrl) {\n      if (!file) return upload.emptyPromise(file, file);\n      if ((disallowObjectUrl && file.$ngfDataUrl != null) || (!disallowObjectUrl && file.$ngfBlobUrl != null)) {\n        return upload.emptyPromise(disallowObjectUrl ? file.$ngfDataUrl : file.$ngfBlobUrl, file);\n      }\n      var p = disallowObjectUrl ? file.$$ngfDataUrlPromise : file.$$ngfBlobUrlPromise;\n      if (p) return p;\n\n      var deferred = $q.defer();\n      $timeout(function () {\n        if (window.FileReader && file &&\n          (!window.FileAPI || navigator.userAgent.indexOf('MSIE 8') === -1 || file.size < 20000) &&\n          (!window.FileAPI || navigator.userAgent.indexOf('MSIE 9') === -1 || file.size < 4000000)) {\n          //prefer URL.createObjectURL for handling refrences to files of all sizes\n          //since it doesnt build a large string in memory\n          var URL = window.URL || window.webkitURL;\n          if (URL && URL.createObjectURL && !disallowObjectUrl) {\n            var url;\n            try {\n              url = URL.createObjectURL(file);\n            } catch (e) {\n              $timeout(function () {\n                file.$ngfBlobUrl = '';\n                deferred.reject();\n              });\n              return;\n            }\n            $timeout(function () {\n              file.$ngfBlobUrl = url;\n              if (url) {\n                deferred.resolve(url, file);\n                upload.blobUrls = upload.blobUrls || [];\n                upload.blobUrlsTotalSize = upload.blobUrlsTotalSize || 0;\n                upload.blobUrls.push({url: url, size: file.size});\n                upload.blobUrlsTotalSize += file.size || 0;\n                var maxMemory = upload.defaults.blobUrlsMaxMemory || 268435456;\n                var maxLength = upload.defaults.blobUrlsMaxQueueSize || 200;\n                while ((upload.blobUrlsTotalSize > maxMemory || upload.blobUrls.length > maxLength) && upload.blobUrls.length > 1) {\n                  var obj = upload.blobUrls.splice(0, 1)[0];\n                  URL.revokeObjectURL(obj.url);\n                  upload.blobUrlsTotalSize -= obj.size;\n                }\n              }\n            });\n          } else {\n            var fileReader = new FileReader();\n            fileReader.onload = function (e) {\n              $timeout(function () {\n                file.$ngfDataUrl = e.target.result;\n                deferred.resolve(e.target.result, file);\n                $timeout(function () {\n                  delete file.$ngfDataUrl;\n                }, 1000);\n              });\n            };\n            fileReader.onerror = function () {\n              $timeout(function () {\n                file.$ngfDataUrl = '';\n                deferred.reject();\n              });\n            };\n            fileReader.readAsDataURL(file);\n          }\n        } else {\n          $timeout(function () {\n            file[disallowObjectUrl ? '$ngfDataUrl' : '$ngfBlobUrl'] = '';\n            deferred.reject();\n          });\n        }\n      });\n\n      if (disallowObjectUrl) {\n        p = file.$$ngfDataUrlPromise = deferred.promise;\n      } else {\n        p = file.$$ngfBlobUrlPromise = deferred.promise;\n      }\n      p['finally'](function () {\n        delete file[disallowObjectUrl ? '$$ngfDataUrlPromise' : '$$ngfBlobUrlPromise'];\n      });\n      return p;\n    };\n    return upload;\n  }]);\n\n  function getTagType(el) {\n    if (el.tagName.toLowerCase() === 'img') return 'image';\n    if (el.tagName.toLowerCase() === 'audio') return 'audio';\n    if (el.tagName.toLowerCase() === 'video') return 'video';\n    return /./;\n  }\n\n  function linkFileDirective(Upload, $timeout, scope, elem, attr, directiveName, resizeParams, isBackground) {\n    function constructDataUrl(file) {\n      var disallowObjectUrl = Upload.attrGetter('ngfNoObjectUrl', attr, scope);\n      Upload.dataUrl(file, disallowObjectUrl)['finally'](function () {\n        $timeout(function () {\n          var src = (disallowObjectUrl ? file.$ngfDataUrl : file.$ngfBlobUrl) || file.$ngfDataUrl;\n          if (isBackground) {\n            elem.css('background-image', 'url(\\'' + (src || '') + '\\')');\n          } else {\n            elem.attr('src', src);\n          }\n          if (src) {\n            elem.removeClass('ng-hide');\n          } else {\n            elem.addClass('ng-hide');\n          }\n        });\n      });\n    }\n\n    $timeout(function () {\n      var unwatch = scope.$watch(attr[directiveName], function (file) {\n        var size = resizeParams;\n        if (directiveName === 'ngfThumbnail') {\n          if (!size) {\n            size = {\n              width: elem[0].naturalWidth || elem[0].clientWidth,\n              height: elem[0].naturalHeight || elem[0].clientHeight\n            };\n          }\n          if (size.width === 0 && window.getComputedStyle) {\n            var style = getComputedStyle(elem[0]);\n            if (style.width && style.width.indexOf('px') > -1 && style.height && style.height.indexOf('px') > -1) {\n              size = {\n                width: parseInt(style.width.slice(0, -2)),\n                height: parseInt(style.height.slice(0, -2))\n              };\n            }\n          }\n        }\n\n        if (angular.isString(file)) {\n          elem.removeClass('ng-hide');\n          if (isBackground) {\n            return elem.css('background-image', 'url(\\'' + file + '\\')');\n          } else {\n            return elem.attr('src', file);\n          }\n        }\n        if (file && file.type && file.type.search(getTagType(elem[0])) === 0 &&\n          (!isBackground || file.type.indexOf('image') === 0)) {\n          if (size && Upload.isResizeSupported()) {\n            size.resizeIf = function (width, height) {\n              return Upload.attrGetter('ngfResizeIf', attr, scope,\n                {$width: width, $height: height, $file: file});\n            };\n            Upload.resize(file, size).then(\n              function (f) {\n                constructDataUrl(f);\n              }, function (e) {\n                throw e;\n              }\n            );\n          } else {\n            constructDataUrl(file);\n          }\n        } else {\n          elem.addClass('ng-hide');\n        }\n      });\n\n      scope.$on('$destroy', function () {\n        unwatch();\n      });\n    });\n  }\n\n\n  /** @namespace attr.ngfSrc */\n  /** @namespace attr.ngfNoObjectUrl */\n  ngFileUpload.directive('ngfSrc', ['Upload', '$timeout', function (Upload, $timeout) {\n    return {\n      restrict: 'AE',\n      link: function (scope, elem, attr) {\n        linkFileDirective(Upload, $timeout, scope, elem, attr, 'ngfSrc',\n          Upload.attrGetter('ngfResize', attr, scope), false);\n      }\n    };\n  }]);\n\n  /** @namespace attr.ngfBackground */\n  /** @namespace attr.ngfNoObjectUrl */\n  ngFileUpload.directive('ngfBackground', ['Upload', '$timeout', function (Upload, $timeout) {\n    return {\n      restrict: 'AE',\n      link: function (scope, elem, attr) {\n        linkFileDirective(Upload, $timeout, scope, elem, attr, 'ngfBackground',\n          Upload.attrGetter('ngfResize', attr, scope), true);\n      }\n    };\n  }]);\n\n  /** @namespace attr.ngfThumbnail */\n  /** @namespace attr.ngfAsBackground */\n  /** @namespace attr.ngfSize */\n  /** @namespace attr.ngfNoObjectUrl */\n  ngFileUpload.directive('ngfThumbnail', ['Upload', '$timeout', function (Upload, $timeout) {\n    return {\n      restrict: 'AE',\n      link: function (scope, elem, attr) {\n        var size = Upload.attrGetter('ngfSize', attr, scope);\n        linkFileDirective(Upload, $timeout, scope, elem, attr, 'ngfThumbnail', size,\n          Upload.attrGetter('ngfAsBackground', attr, scope));\n      }\n    };\n  }]);\n\n  ngFileUpload.config(['$compileProvider', function ($compileProvider) {\n    if ($compileProvider.imgSrcSanitizationWhitelist) $compileProvider.imgSrcSanitizationWhitelist(/^\\s*(https?|ftp|mailto|tel|webcal|local|file|data|blob):/);\n    if ($compileProvider.aHrefSanitizationWhitelist) $compileProvider.aHrefSanitizationWhitelist(/^\\s*(https?|ftp|mailto|tel|webcal|local|file|data|blob):/);\n  }]);\n\n  ngFileUpload.filter('ngfDataUrl', ['UploadDataUrl', '$sce', function (UploadDataUrl, $sce) {\n    return function (file, disallowObjectUrl, trustedUrl) {\n      if (angular.isString(file)) {\n        return $sce.trustAsResourceUrl(file);\n      }\n      var src = file && ((disallowObjectUrl ? file.$ngfDataUrl : file.$ngfBlobUrl) || file.$ngfDataUrl);\n      if (file && !src) {\n        if (!file.$ngfDataUrlFilterInProgress && angular.isObject(file)) {\n          file.$ngfDataUrlFilterInProgress = true;\n          UploadDataUrl.dataUrl(file, disallowObjectUrl);\n        }\n        return '';\n      }\n      if (file) delete file.$ngfDataUrlFilterInProgress;\n      return (file && src ? (trustedUrl ? $sce.trustAsResourceUrl(src) : src) : file) || '';\n    };\n  }]);\n\n})();\n\nngFileUpload.service('UploadValidate', ['UploadDataUrl', '$q', '$timeout', function (UploadDataUrl, $q, $timeout) {\n  var upload = UploadDataUrl;\n\n  function globStringToRegex(str) {\n    var regexp = '', excludes = [];\n    if (str.length > 2 && str[0] === '/' && str[str.length - 1] === '/') {\n      regexp = str.substring(1, str.length - 1);\n    } else {\n      var split = str.split(',');\n      if (split.length > 1) {\n        for (var i = 0; i < split.length; i++) {\n          var r = globStringToRegex(split[i]);\n          if (r.regexp) {\n            regexp += '(' + r.regexp + ')';\n            if (i < split.length - 1) {\n              regexp += '|';\n            }\n          } else {\n            excludes = excludes.concat(r.excludes);\n          }\n        }\n      } else {\n        if (str.indexOf('!') === 0) {\n          excludes.push('^((?!' + globStringToRegex(str.substring(1)).regexp + ').)*$');\n        } else {\n          if (str.indexOf('.') === 0) {\n            str = '*' + str;\n          }\n          regexp = '^' + str.replace(new RegExp('[.\\\\\\\\+*?\\\\[\\\\^\\\\]$(){}=!<>|:\\\\-]', 'g'), '\\\\$&') + '$';\n          regexp = regexp.replace(/\\\\\\*/g, '.*').replace(/\\\\\\?/g, '.');\n        }\n      }\n    }\n    return {regexp: regexp, excludes: excludes};\n  }\n\n  upload.validatePattern = function (file, val) {\n    if (!val) {\n      return true;\n    }\n    var pattern = globStringToRegex(val), valid = true;\n    if (pattern.regexp && pattern.regexp.length) {\n      var regexp = new RegExp(pattern.regexp, 'i');\n      valid = (file.type != null && regexp.test(file.type)) ||\n        (file.name != null && regexp.test(file.name));\n    }\n    var len = pattern.excludes.length;\n    while (len--) {\n      var exclude = new RegExp(pattern.excludes[len], 'i');\n      valid = valid && (file.type == null || exclude.test(file.type)) &&\n        (file.name == null || exclude.test(file.name));\n    }\n    return valid;\n  };\n\n  upload.ratioToFloat = function (val) {\n    var r = val.toString(), xIndex = r.search(/[x:]/i);\n    if (xIndex > -1) {\n      r = parseFloat(r.substring(0, xIndex)) / parseFloat(r.substring(xIndex + 1));\n    } else {\n      r = parseFloat(r);\n    }\n    return r;\n  };\n\n  upload.registerModelChangeValidator = function (ngModel, attr, scope) {\n    if (ngModel) {\n      ngModel.$formatters.push(function (files) {\n        if (ngModel.$dirty) {\n          var filesArray = files;\n          if (files && !angular.isArray(files)) {\n            filesArray = [files];\n          }\n          upload.validate(filesArray, 0, ngModel, attr, scope).then(function () {\n            upload.applyModelValidation(ngModel, filesArray);\n          });\n        }\n        return files;\n      });\n    }\n  };\n\n  function markModelAsDirty(ngModel, files) {\n    if (files != null && !ngModel.$dirty) {\n      if (ngModel.$setDirty) {\n        ngModel.$setDirty();\n      } else {\n        ngModel.$dirty = true;\n      }\n    }\n  }\n\n  upload.applyModelValidation = function (ngModel, files) {\n    markModelAsDirty(ngModel, files);\n    angular.forEach(ngModel.$ngfValidations, function (validation) {\n      ngModel.$setValidity(validation.name, validation.valid);\n    });\n  };\n\n  upload.getValidationAttr = function (attr, scope, name, validationName, file) {\n    var dName = 'ngf' + name[0].toUpperCase() + name.substr(1);\n    var val = upload.attrGetter(dName, attr, scope, {$file: file});\n    if (val == null) {\n      val = upload.attrGetter('ngfValidate', attr, scope, {$file: file});\n      if (val) {\n        var split = (validationName || name).split('.');\n        val = val[split[0]];\n        if (split.length > 1) {\n          val = val && val[split[1]];\n        }\n      }\n    }\n    return val;\n  };\n\n  upload.validate = function (files, prevLength, ngModel, attr, scope) {\n    ngModel = ngModel || {};\n    ngModel.$ngfValidations = ngModel.$ngfValidations || [];\n\n    angular.forEach(ngModel.$ngfValidations, function (v) {\n      v.valid = true;\n    });\n\n    var attrGetter = function (name, params) {\n      return upload.attrGetter(name, attr, scope, params);\n    };\n\n    var ignoredErrors = (upload.attrGetter('ngfIgnoreInvalid', attr, scope) || '').split(' ');\n    var runAllValidation = upload.attrGetter('ngfRunAllValidations', attr, scope);\n\n    if (files == null || files.length === 0) {\n      return upload.emptyPromise({'validFiles': files, 'invalidFiles': []});\n    }\n\n    files = files.length === undefined ? [files] : files.slice(0);\n    var invalidFiles = [];\n\n    function validateSync(name, validationName, fn) {\n      if (files) {\n        var i = files.length, valid = null;\n        while (i--) {\n          var file = files[i];\n          if (file) {\n            var val = upload.getValidationAttr(attr, scope, name, validationName, file);\n            if (val != null) {\n              if (!fn(file, val, i)) {\n                if (ignoredErrors.indexOf(name) === -1) {\n                  file.$error = name;\n                  (file.$errorMessages = (file.$errorMessages || {}))[name] = true;\n                  file.$errorParam = val;\n                  if (invalidFiles.indexOf(file) === -1) {\n                    invalidFiles.push(file);\n                  }\n                  if (!runAllValidation) {\n                    files.splice(i, 1);\n                  }\n                  valid = false;\n                } else {\n                  files.splice(i, 1);\n                }\n              }\n            }\n          }\n        }\n        if (valid !== null) {\n          ngModel.$ngfValidations.push({name: name, valid: valid});\n        }\n      }\n    }\n\n    validateSync('pattern', null, upload.validatePattern);\n    validateSync('minSize', 'size.min', function (file, val) {\n      return file.size + 0.1 >= upload.translateScalars(val);\n    });\n    validateSync('maxSize', 'size.max', function (file, val) {\n      return file.size - 0.1 <= upload.translateScalars(val);\n    });\n    var totalSize = 0;\n    validateSync('maxTotalSize', null, function (file, val) {\n      totalSize += file.size;\n      if (totalSize > upload.translateScalars(val)) {\n        files.splice(0, files.length);\n        return false;\n      }\n      return true;\n    });\n\n    validateSync('validateFn', null, function (file, r) {\n      return r === true || r === null || r === '';\n    });\n\n    if (!files.length) {\n      return upload.emptyPromise({'validFiles': [], 'invalidFiles': invalidFiles});\n    }\n\n    function validateAsync(name, validationName, type, asyncFn, fn) {\n      function resolveResult(defer, file, val) {\n        function resolveInternal(fn) {\n          if (fn()) {\n            if (ignoredErrors.indexOf(name) === -1) {\n              file.$error = name;\n              (file.$errorMessages = (file.$errorMessages || {}))[name] = true;\n              file.$errorParam = val;\n              if (invalidFiles.indexOf(file) === -1) {\n                invalidFiles.push(file);\n              }\n              if (!runAllValidation) {\n                var i = files.indexOf(file);\n                if (i > -1) files.splice(i, 1);\n              }\n              defer.resolve(false);\n            } else {\n              var j = files.indexOf(file);\n              if (j > -1) files.splice(j, 1);\n              defer.resolve(true);\n            }\n          } else {\n            defer.resolve(true);\n          }\n        }\n\n        if (val != null) {\n          asyncFn(file, val).then(function (d) {\n            resolveInternal(function () {\n              return !fn(d, val);\n            });\n          }, function () {\n            resolveInternal(function () {\n              return attrGetter('ngfValidateForce', {$file: file});\n            });\n          });\n        } else {\n          defer.resolve(true);\n        }\n      }\n\n      var promises = [upload.emptyPromise(true)];\n      if (files) {\n        files = files.length === undefined ? [files] : files;\n        angular.forEach(files, function (file) {\n          var defer = $q.defer();\n          promises.push(defer.promise);\n          if (type && (file.type == null || file.type.search(type) !== 0)) {\n            defer.resolve(true);\n            return;\n          }\n          if (name === 'dimensions' && upload.attrGetter('ngfDimensions', attr) != null) {\n            upload.imageDimensions(file).then(function (d) {\n              resolveResult(defer, file,\n                attrGetter('ngfDimensions', {$file: file, $width: d.width, $height: d.height}));\n            }, function () {\n              defer.resolve(false);\n            });\n          } else if (name === 'duration' && upload.attrGetter('ngfDuration', attr) != null) {\n            upload.mediaDuration(file).then(function (d) {\n              resolveResult(defer, file,\n                attrGetter('ngfDuration', {$file: file, $duration: d}));\n            }, function () {\n              defer.resolve(false);\n            });\n          } else {\n            resolveResult(defer, file,\n              upload.getValidationAttr(attr, scope, name, validationName, file));\n          }\n        });\n      }\n      var deffer = $q.defer();\n      $q.all(promises).then(function (values) {\n        var isValid = true;\n        for (var i = 0; i < values.length; i++) {\n          if (!values[i]) {\n            isValid = false;\n            break;\n          }\n        }\n        ngModel.$ngfValidations.push({name: name, valid: isValid});\n        deffer.resolve(isValid);\n      });\n      return deffer.promise;\n    }\n\n    var deffer = $q.defer();\n    var promises = [];\n\n    promises.push(validateAsync('maxHeight', 'height.max', /image/,\n      this.imageDimensions, function (d, val) {\n        return d.height <= val;\n      }));\n    promises.push(validateAsync('minHeight', 'height.min', /image/,\n      this.imageDimensions, function (d, val) {\n        return d.height >= val;\n      }));\n    promises.push(validateAsync('maxWidth', 'width.max', /image/,\n      this.imageDimensions, function (d, val) {\n        return d.width <= val;\n      }));\n    promises.push(validateAsync('minWidth', 'width.min', /image/,\n      this.imageDimensions, function (d, val) {\n        return d.width >= val;\n      }));\n    promises.push(validateAsync('dimensions', null, /image/,\n      function (file, val) {\n        return upload.emptyPromise(val);\n      }, function (r) {\n        return r;\n      }));\n    promises.push(validateAsync('ratio', null, /image/,\n      this.imageDimensions, function (d, val) {\n        var split = val.toString().split(','), valid = false;\n        for (var i = 0; i < split.length; i++) {\n          if (Math.abs((d.width / d.height) - upload.ratioToFloat(split[i])) < 0.01) {\n            valid = true;\n          }\n        }\n        return valid;\n      }));\n    promises.push(validateAsync('maxRatio', 'ratio.max', /image/,\n      this.imageDimensions, function (d, val) {\n        return (d.width / d.height) - upload.ratioToFloat(val) < 0.0001;\n      }));\n    promises.push(validateAsync('minRatio', 'ratio.min', /image/,\n      this.imageDimensions, function (d, val) {\n        return (d.width / d.height) - upload.ratioToFloat(val) > -0.0001;\n      }));\n    promises.push(validateAsync('maxDuration', 'duration.max', /audio|video/,\n      this.mediaDuration, function (d, val) {\n        return d <= upload.translateScalars(val);\n      }));\n    promises.push(validateAsync('minDuration', 'duration.min', /audio|video/,\n      this.mediaDuration, function (d, val) {\n        return d >= upload.translateScalars(val);\n      }));\n    promises.push(validateAsync('duration', null, /audio|video/,\n      function (file, val) {\n        return upload.emptyPromise(val);\n      }, function (r) {\n        return r;\n      }));\n\n    promises.push(validateAsync('validateAsyncFn', null, null,\n      function (file, val) {\n        return val;\n      }, function (r) {\n        return r === true || r === null || r === '';\n      }));\n\n    $q.all(promises).then(function () {\n\n      if (runAllValidation) {\n        for (var i = 0; i < files.length; i++) {\n          var file = files[i];\n          if (file.$error) {\n            files.splice(i--, 1);\n          }\n        }\n      }\n\n      runAllValidation = false;\n      validateSync('maxFiles', null, function (file, val, i) {\n        return prevLength + i < val;\n      });\n\n      deffer.resolve({'validFiles': files, 'invalidFiles': invalidFiles});\n    });\n    return deffer.promise;\n  };\n\n  upload.imageDimensions = function (file) {\n    if (file.$ngfWidth && file.$ngfHeight) {\n      var d = $q.defer();\n      $timeout(function () {\n        d.resolve({width: file.$ngfWidth, height: file.$ngfHeight});\n      });\n      return d.promise;\n    }\n    if (file.$ngfDimensionPromise) return file.$ngfDimensionPromise;\n\n    var deferred = $q.defer();\n    $timeout(function () {\n      if (file.type.indexOf('image') !== 0) {\n        deferred.reject('not image');\n        return;\n      }\n      upload.dataUrl(file).then(function (dataUrl) {\n        var img = angular.element('<img>').attr('src', dataUrl)\n          .css('visibility', 'hidden').css('position', 'fixed')\n          .css('max-width', 'none !important').css('max-height', 'none !important');\n\n        function success() {\n          var width = img[0].naturalWidth || img[0].clientWidth;\n          var height = img[0].naturalHeight || img[0].clientHeight;\n          img.remove();\n          file.$ngfWidth = width;\n          file.$ngfHeight = height;\n          deferred.resolve({width: width, height: height});\n        }\n\n        function error() {\n          img.remove();\n          deferred.reject('load error');\n        }\n\n        img.on('load', success);\n        img.on('error', error);\n\n        var secondsCounter = 0;\n        function checkLoadErrorInCaseOfNoCallback() {\n          $timeout(function () {\n            if (img[0].parentNode) {\n              if (img[0].clientWidth) {\n                success();\n              } else if (secondsCounter++ > 10) {\n                error();\n              } else {\n                checkLoadErrorInCaseOfNoCallback();\n              }\n            }\n          }, 1000);\n        }\n\n        checkLoadErrorInCaseOfNoCallback();\n\n        angular.element(document.getElementsByTagName('body')[0]).append(img);\n      }, function () {\n        deferred.reject('load error');\n      });\n    });\n\n    file.$ngfDimensionPromise = deferred.promise;\n    file.$ngfDimensionPromise['finally'](function () {\n      delete file.$ngfDimensionPromise;\n    });\n    return file.$ngfDimensionPromise;\n  };\n\n  upload.mediaDuration = function (file) {\n    if (file.$ngfDuration) {\n      var d = $q.defer();\n      $timeout(function () {\n        d.resolve(file.$ngfDuration);\n      });\n      return d.promise;\n    }\n    if (file.$ngfDurationPromise) return file.$ngfDurationPromise;\n\n    var deferred = $q.defer();\n    $timeout(function () {\n      if (file.type.indexOf('audio') !== 0 && file.type.indexOf('video') !== 0) {\n        deferred.reject('not media');\n        return;\n      }\n      upload.dataUrl(file).then(function (dataUrl) {\n        var el = angular.element(file.type.indexOf('audio') === 0 ? '<audio>' : '<video>')\n          .attr('src', dataUrl).css('visibility', 'none').css('position', 'fixed');\n\n        function success() {\n          var duration = el[0].duration;\n          file.$ngfDuration = duration;\n          el.remove();\n          deferred.resolve(duration);\n        }\n\n        function error() {\n          el.remove();\n          deferred.reject('load error');\n        }\n\n        el.on('loadedmetadata', success);\n        el.on('error', error);\n        var count = 0;\n\n        function checkLoadError() {\n          $timeout(function () {\n            if (el[0].parentNode) {\n              if (el[0].duration) {\n                success();\n              } else if (count > 10) {\n                error();\n              } else {\n                checkLoadError();\n              }\n            }\n          }, 1000);\n        }\n\n        checkLoadError();\n\n        angular.element(document.body).append(el);\n      }, function () {\n        deferred.reject('load error');\n      });\n    });\n\n    file.$ngfDurationPromise = deferred.promise;\n    file.$ngfDurationPromise['finally'](function () {\n      delete file.$ngfDurationPromise;\n    });\n    return file.$ngfDurationPromise;\n  };\n  return upload;\n}\n]);\n\nngFileUpload.service('UploadResize', ['UploadValidate', '$q', function (UploadValidate, $q) {\n  var upload = UploadValidate;\n\n  /**\n   * Conserve aspect ratio of the original region. Useful when shrinking/enlarging\n   * images to fit into a certain area.\n   * Source:  http://stackoverflow.com/a/14731922\n   *\n   * @param {Number} srcWidth Source area width\n   * @param {Number} srcHeight Source area height\n   * @param {Number} maxWidth Nestable area maximum available width\n   * @param {Number} maxHeight Nestable area maximum available height\n   * @return {Object} { width, height }\n   */\n  var calculateAspectRatioFit = function (srcWidth, srcHeight, maxWidth, maxHeight, centerCrop) {\n    var ratio = centerCrop ? Math.max(maxWidth / srcWidth, maxHeight / srcHeight) :\n      Math.min(maxWidth / srcWidth, maxHeight / srcHeight);\n    return {\n      width: srcWidth * ratio, height: srcHeight * ratio,\n      marginX: srcWidth * ratio - maxWidth, marginY: srcHeight * ratio - maxHeight\n    };\n  };\n\n  // Extracted from https://github.com/romelgomez/angular-firebase-image-upload/blob/master/app/scripts/fileUpload.js#L89\n  var resize = function (imagen, width, height, quality, type, ratio, centerCrop, resizeIf) {\n    var deferred = $q.defer();\n    var canvasElement = document.createElement('canvas');\n    var imageElement = document.createElement('img');\n    imageElement.setAttribute('style', 'visibility:hidden;position:fixed;z-index:-100000');\n    document.body.appendChild(imageElement);\n\n    imageElement.onload = function () {\n      var imgWidth = imageElement.width, imgHeight = imageElement.height;\n      imageElement.parentNode.removeChild(imageElement);\n      if (resizeIf != null && resizeIf(imgWidth, imgHeight) === false) {\n        deferred.reject('resizeIf');\n        return;\n      }\n      try {\n        if (ratio) {\n          var ratioFloat = upload.ratioToFloat(ratio);\n          var imgRatio = imgWidth / imgHeight;\n          if (imgRatio < ratioFloat) {\n            width = imgWidth;\n            height = width / ratioFloat;\n          } else {\n            height = imgHeight;\n            width = height * ratioFloat;\n          }\n        }\n        if (!width) {\n          width = imgWidth;\n        }\n        if (!height) {\n          height = imgHeight;\n        }\n        var dimensions = calculateAspectRatioFit(imgWidth, imgHeight, width, height, centerCrop);\n        canvasElement.width = Math.min(dimensions.width, width);\n        canvasElement.height = Math.min(dimensions.height, height);\n        var context = canvasElement.getContext('2d');\n        context.drawImage(imageElement,\n          Math.min(0, -dimensions.marginX / 2), Math.min(0, -dimensions.marginY / 2),\n          dimensions.width, dimensions.height);\n        deferred.resolve(canvasElement.toDataURL(type || 'image/WebP', quality || 0.934));\n      } catch (e) {\n        deferred.reject(e);\n      }\n    };\n    imageElement.onerror = function () {\n      imageElement.parentNode.removeChild(imageElement);\n      deferred.reject();\n    };\n    imageElement.src = imagen;\n    return deferred.promise;\n  };\n\n  upload.dataUrltoBlob = function (dataurl, name, origSize) {\n    var arr = dataurl.split(','), mime = arr[0].match(/:(.*?);/)[1],\n      bstr = atob(arr[1]), n = bstr.length, u8arr = new Uint8Array(n);\n    while (n--) {\n      u8arr[n] = bstr.charCodeAt(n);\n    }\n    var blob = new window.Blob([u8arr], {type: mime});\n    blob.name = name;\n    blob.$ngfOrigSize = origSize;\n    return blob;\n  };\n\n  upload.isResizeSupported = function () {\n    var elem = document.createElement('canvas');\n    return window.atob && elem.getContext && elem.getContext('2d') && window.Blob;\n  };\n\n  if (upload.isResizeSupported()) {\n    // add name getter to the blob constructor prototype\n    Object.defineProperty(window.Blob.prototype, 'name', {\n      get: function () {\n        return this.$ngfName;\n      },\n      set: function (v) {\n        this.$ngfName = v;\n      },\n      configurable: true\n    });\n  }\n\n  upload.resize = function (file, options) {\n    if (file.type.indexOf('image') !== 0) return upload.emptyPromise(file);\n\n    var deferred = $q.defer();\n    upload.dataUrl(file, true).then(function (url) {\n      resize(url, options.width, options.height, options.quality, options.type || file.type,\n        options.ratio, options.centerCrop, options.resizeIf)\n        .then(function (dataUrl) {\n          if (file.type === 'image/jpeg' && options.restoreExif !== false) {\n            try {\n              dataUrl = upload.restoreExif(url, dataUrl);\n            } catch (e) {\n              setTimeout(function () {throw e;}, 1);\n            }\n          }\n          try {\n            var blob = upload.dataUrltoBlob(dataUrl, file.name, file.size);\n            deferred.resolve(blob);\n          } catch (e) {\n            deferred.reject(e);\n          }\n        }, function (r) {\n          if (r === 'resizeIf') {\n            deferred.resolve(file);\n          }\n          deferred.reject(r);\n        });\n    }, function (e) {\n      deferred.reject(e);\n    });\n    return deferred.promise;\n  };\n\n  return upload;\n}]);\n\n(function () {\n  ngFileUpload.directive('ngfDrop', ['$parse', '$timeout', '$window', 'Upload', '$http', '$q',\n    function ($parse, $timeout, $window, Upload, $http, $q) {\n      return {\n        restrict: 'AEC',\n        require: '?ngModel',\n        link: function (scope, elem, attr, ngModel) {\n          linkDrop(scope, elem, attr, ngModel, $parse, $timeout, $window, Upload, $http, $q);\n        }\n      };\n    }]);\n\n  ngFileUpload.directive('ngfNoFileDrop', function () {\n    return function (scope, elem) {\n      if (dropAvailable()) elem.css('display', 'none');\n    };\n  });\n\n  ngFileUpload.directive('ngfDropAvailable', ['$parse', '$timeout', 'Upload', function ($parse, $timeout, Upload) {\n    return function (scope, elem, attr) {\n      if (dropAvailable()) {\n        var model = $parse(Upload.attrGetter('ngfDropAvailable', attr));\n        $timeout(function () {\n          model(scope);\n          if (model.assign) {\n            model.assign(scope, true);\n          }\n        });\n      }\n    };\n  }]);\n\n  function linkDrop(scope, elem, attr, ngModel, $parse, $timeout, $window, upload, $http, $q) {\n    var available = dropAvailable();\n\n    var attrGetter = function (name, scope, params) {\n      return upload.attrGetter(name, attr, scope, params);\n    };\n\n    if (attrGetter('dropAvailable')) {\n      $timeout(function () {\n        if (scope[attrGetter('dropAvailable')]) {\n          scope[attrGetter('dropAvailable')].value = available;\n        } else {\n          scope[attrGetter('dropAvailable')] = available;\n        }\n      });\n    }\n    if (!available) {\n      if (attrGetter('ngfHideOnDropNotAvailable', scope) === true) {\n        elem.css('display', 'none');\n      }\n      return;\n    }\n\n    function isDisabled() {\n      return elem.attr('disabled') || attrGetter('ngfDropDisabled', scope);\n    }\n\n    if (attrGetter('ngfSelect') == null) {\n      upload.registerModelChangeValidator(ngModel, attr, scope);\n    }\n\n    var leaveTimeout = null;\n    var stopPropagation = $parse(attrGetter('ngfStopPropagation'));\n    var dragOverDelay = 1;\n    var actualDragOverClass;\n\n    elem[0].addEventListener('dragover', function (evt) {\n      if (isDisabled() || !upload.shouldUpdateOn('drop', attr, scope)) return;\n      evt.preventDefault();\n      if (stopPropagation(scope)) evt.stopPropagation();\n      // handling dragover events from the Chrome download bar\n      if (navigator.userAgent.indexOf('Chrome') > -1) {\n        var b = evt.dataTransfer.effectAllowed;\n        evt.dataTransfer.dropEffect = ('move' === b || 'linkMove' === b) ? 'move' : 'copy';\n      }\n      $timeout.cancel(leaveTimeout);\n      if (!actualDragOverClass) {\n        actualDragOverClass = 'C';\n        calculateDragOverClass(scope, attr, evt, function (clazz) {\n          actualDragOverClass = clazz;\n          elem.addClass(actualDragOverClass);\n          attrGetter('ngfDrag', scope, {$isDragging: true, $class: actualDragOverClass, $event: evt});\n        });\n      }\n    }, false);\n    elem[0].addEventListener('dragenter', function (evt) {\n      if (isDisabled() || !upload.shouldUpdateOn('drop', attr, scope)) return;\n      evt.preventDefault();\n      if (stopPropagation(scope)) evt.stopPropagation();\n    }, false);\n    elem[0].addEventListener('dragleave', function (evt) {\n      if (isDisabled() || !upload.shouldUpdateOn('drop', attr, scope)) return;\n      evt.preventDefault();\n      if (stopPropagation(scope)) evt.stopPropagation();\n      leaveTimeout = $timeout(function () {\n        if (actualDragOverClass) elem.removeClass(actualDragOverClass);\n        actualDragOverClass = null;\n        attrGetter('ngfDrag', scope, {$isDragging: false, $event: evt});\n      }, dragOverDelay || 100);\n    }, false);\n    elem[0].addEventListener('drop', function (evt) {\n      if (isDisabled() || !upload.shouldUpdateOn('drop', attr, scope)) return;\n      evt.preventDefault();\n      if (stopPropagation(scope)) evt.stopPropagation();\n      if (actualDragOverClass) elem.removeClass(actualDragOverClass);\n      actualDragOverClass = null;\n      extractFilesAndUpdateModel(evt.dataTransfer, evt, 'dropUrl');\n    }, false);\n    elem[0].addEventListener('paste', function (evt) {\n      if (navigator.userAgent.toLowerCase().indexOf('firefox') > -1 &&\n        attrGetter('ngfEnableFirefoxPaste', scope)) {\n        evt.preventDefault();\n      }\n      if (isDisabled() || !upload.shouldUpdateOn('paste', attr, scope)) return;\n      extractFilesAndUpdateModel(evt.clipboardData || evt.originalEvent.clipboardData, evt, 'pasteUrl');\n    }, false);\n\n    if (navigator.userAgent.toLowerCase().indexOf('firefox') > -1 &&\n      attrGetter('ngfEnableFirefoxPaste', scope)) {\n      elem.attr('contenteditable', true);\n      elem.on('keypress', function (e) {\n        if (!e.metaKey && !e.ctrlKey) {\n          e.preventDefault();\n        }\n      });\n    }\n\n    function extractFilesAndUpdateModel(source, evt, updateOnType) {\n      if (!source) return;\n      // html needs to be calculated on the same process otherwise the data will be wiped\n      // after promise resolve or setTimeout.\n      var html;\n      try {\n        html = source && source.getData && source.getData('text/html');\n      } catch (e) {/* Fix IE11 that throw error calling getData */\n      }\n      extractFiles(source.items, source.files, attrGetter('ngfAllowDir', scope) !== false,\n        attrGetter('multiple') || attrGetter('ngfMultiple', scope)).then(function (files) {\n        if (files.length) {\n          updateModel(files, evt);\n        } else {\n          extractFilesFromHtml(updateOnType, html).then(function (files) {\n            updateModel(files, evt);\n          });\n        }\n      });\n    }\n\n    function updateModel(files, evt) {\n      upload.updateModel(ngModel, attr, scope, attrGetter('ngfChange') || attrGetter('ngfDrop'), files, evt);\n    }\n\n    function extractFilesFromHtml(updateOn, html) {\n      if (!upload.shouldUpdateOn(updateOn, attr, scope) || typeof html !== 'string') return upload.rejectPromise([]);\n      var urls = [];\n      html.replace(/<(img src|img [^>]* src) *=\\\"([^\\\"]*)\\\"/gi, function (m, n, src) {\n        urls.push(src);\n      });\n      var promises = [], files = [];\n      if (urls.length) {\n        angular.forEach(urls, function (url) {\n          promises.push(upload.urlToBlob(url).then(function (blob) {\n            files.push(blob);\n          }));\n        });\n        var defer = $q.defer();\n        $q.all(promises).then(function () {\n          defer.resolve(files);\n        }, function (e) {\n          defer.reject(e);\n        });\n        return defer.promise;\n      }\n      return upload.emptyPromise();\n    }\n\n    function calculateDragOverClass(scope, attr, evt, callback) {\n      var obj = attrGetter('ngfDragOverClass', scope, {$event: evt}), dClass = 'dragover';\n      if (angular.isString(obj)) {\n        dClass = obj;\n      } else if (obj) {\n        if (obj.delay) dragOverDelay = obj.delay;\n        if (obj.accept || obj.reject) {\n          var items = evt.dataTransfer.items;\n          if (items == null || !items.length) {\n            dClass = obj.accept;\n          } else {\n            var pattern = obj.pattern || attrGetter('ngfPattern', scope, {$event: evt});\n            var len = items.length;\n            while (len--) {\n              if (!upload.validatePattern(items[len], pattern)) {\n                dClass = obj.reject;\n                break;\n              } else {\n                dClass = obj.accept;\n              }\n            }\n          }\n        }\n      }\n      callback(dClass);\n    }\n\n    function extractFiles(items, fileList, allowDir, multiple) {\n      var maxFiles = upload.getValidationAttr(attr, scope, 'maxFiles');\n      if (maxFiles == null) {\n        maxFiles = Number.MAX_VALUE;\n      }\n      var maxTotalSize = upload.getValidationAttr(attr, scope, 'maxTotalSize');\n      if (maxTotalSize == null) {\n        maxTotalSize = Number.MAX_VALUE;\n      }\n      var includeDir = attrGetter('ngfIncludeDir', scope);\n      var files = [], totalSize = 0;\n\n      function traverseFileTree(entry, path) {\n        var defer = $q.defer();\n        if (entry != null) {\n          if (entry.isDirectory) {\n            var promises = [upload.emptyPromise()];\n            if (includeDir) {\n              var file = {type: 'directory'};\n              file.name = file.path = (path || '') + entry.name;\n              files.push(file);\n            }\n            var dirReader = entry.createReader();\n            var entries = [];\n            var readEntries = function () {\n              dirReader.readEntries(function (results) {\n                try {\n                  if (!results.length) {\n                    angular.forEach(entries.slice(0), function (e) {\n                      if (files.length <= maxFiles && totalSize <= maxTotalSize) {\n                        promises.push(traverseFileTree(e, (path ? path : '') + entry.name + '/'));\n                      }\n                    });\n                    $q.all(promises).then(function () {\n                      defer.resolve();\n                    }, function (e) {\n                      defer.reject(e);\n                    });\n                  } else {\n                    entries = entries.concat(Array.prototype.slice.call(results || [], 0));\n                    readEntries();\n                  }\n                } catch (e) {\n                  defer.reject(e);\n                }\n              }, function (e) {\n                defer.reject(e);\n              });\n            };\n            readEntries();\n          } else {\n            entry.file(function (file) {\n              try {\n                file.path = (path ? path : '') + file.name;\n                if (includeDir) {\n                  file = upload.rename(file, file.path);\n                }\n                files.push(file);\n                totalSize += file.size;\n                defer.resolve();\n              } catch (e) {\n                defer.reject(e);\n              }\n            }, function (e) {\n              defer.reject(e);\n            });\n          }\n        }\n        return defer.promise;\n      }\n\n      var promises = [upload.emptyPromise()];\n\n      if (items && items.length > 0 && $window.location.protocol !== 'file:') {\n        for (var i = 0; i < items.length; i++) {\n          if (items[i].webkitGetAsEntry && items[i].webkitGetAsEntry() && items[i].webkitGetAsEntry().isDirectory) {\n            var entry = items[i].webkitGetAsEntry();\n            if (entry.isDirectory && !allowDir) {\n              continue;\n            }\n            if (entry != null) {\n              promises.push(traverseFileTree(entry));\n            }\n          } else {\n            var f = items[i].getAsFile();\n            if (f != null) {\n              files.push(f);\n              totalSize += f.size;\n            }\n          }\n          if (files.length > maxFiles || totalSize > maxTotalSize ||\n            (!multiple && files.length > 0)) break;\n        }\n      } else {\n        if (fileList != null) {\n          for (var j = 0; j < fileList.length; j++) {\n            var file = fileList.item(j);\n            if (file.type || file.size > 0) {\n              files.push(file);\n              totalSize += file.size;\n            }\n            if (files.length > maxFiles || totalSize > maxTotalSize ||\n              (!multiple && files.length > 0)) break;\n          }\n        }\n      }\n\n      var defer = $q.defer();\n      $q.all(promises).then(function () {\n        if (!multiple && !includeDir && files.length) {\n          var i = 0;\n          while (files[i] && files[i].type === 'directory') i++;\n          defer.resolve([files[i]]);\n        } else {\n          defer.resolve(files);\n        }\n      }, function (e) {\n        defer.reject(e);\n      });\n\n      return defer.promise;\n    }\n  }\n\n  function dropAvailable() {\n    var div = document.createElement('div');\n    return ('draggable' in div) && ('ondrop' in div) && !/Edge\\/12./i.test(navigator.userAgent);\n  }\n\n})();\n\n// customized version of https://github.com/exif-js/exif-js\nngFileUpload.service('UploadExif', ['UploadResize', '$q', function (UploadResize, $q) {\n  var upload = UploadResize;\n\n  upload.isExifSupported = function () {\n    return window.FileReader && new FileReader().readAsArrayBuffer && upload.isResizeSupported();\n  };\n\n  function applyTransform(ctx, orientation, width, height) {\n    switch (orientation) {\n      case 2:\n        return ctx.transform(-1, 0, 0, 1, width, 0);\n      case 3:\n        return ctx.transform(-1, 0, 0, -1, width, height);\n      case 4:\n        return ctx.transform(1, 0, 0, -1, 0, height);\n      case 5:\n        return ctx.transform(0, 1, 1, 0, 0, 0);\n      case 6:\n        return ctx.transform(0, 1, -1, 0, height, 0);\n      case 7:\n        return ctx.transform(0, -1, -1, 0, height, width);\n      case 8:\n        return ctx.transform(0, -1, 1, 0, 0, width);\n    }\n  }\n\n  upload.readOrientation = function (file) {\n    var defer = $q.defer();\n    var reader = new FileReader();\n    var slicedFile = file.slice ? file.slice(0, 64 * 1024) : file;\n    reader.readAsArrayBuffer(slicedFile);\n    reader.onerror = function (e) {\n      return defer.reject(e);\n    };\n    reader.onload = function (e) {\n      var result = {orientation: 1};\n      var view = new DataView(this.result);\n      if (view.getUint16(0, false) !== 0xFFD8) return defer.resolve(result);\n\n      var length = view.byteLength,\n        offset = 2;\n      while (offset < length) {\n        var marker = view.getUint16(offset, false);\n        offset += 2;\n        if (marker === 0xFFE1) {\n          if (view.getUint32(offset += 2, false) !== 0x45786966) return defer.resolve(result);\n\n          var little = view.getUint16(offset += 6, false) === 0x4949;\n          offset += view.getUint32(offset + 4, little);\n          var tags = view.getUint16(offset, little);\n          offset += 2;\n          for (var i = 0; i < tags; i++)\n            if (view.getUint16(offset + (i * 12), little) === 0x0112) {\n              var orientation = view.getUint16(offset + (i * 12) + 8, little);\n              if (orientation >= 2 && orientation <= 8) {\n                view.setUint16(offset + (i * 12) + 8, 1, little);\n                result.fixedArrayBuffer = e.target.result;\n              }\n              result.orientation = orientation;\n              return defer.resolve(result);\n            }\n        } else if ((marker & 0xFF00) !== 0xFF00) break;\n        else offset += view.getUint16(offset, false);\n      }\n      return defer.resolve(result);\n    };\n    return defer.promise;\n  };\n\n  function arrayBufferToBase64(buffer) {\n    var binary = '';\n    var bytes = new Uint8Array(buffer);\n    var len = bytes.byteLength;\n    for (var i = 0; i < len; i++) {\n      binary += String.fromCharCode(bytes[i]);\n    }\n    return window.btoa(binary);\n  }\n\n  upload.applyExifRotation = function (file) {\n    if (file.type.indexOf('image/jpeg') !== 0) {\n      return upload.emptyPromise(file);\n    }\n\n    var deferred = $q.defer();\n    upload.readOrientation(file).then(function (result) {\n      if (result.orientation < 2 || result.orientation > 8) {\n        return deferred.resolve(file);\n      }\n      upload.dataUrl(file, true).then(function (url) {\n        var canvas = document.createElement('canvas');\n        var img = document.createElement('img');\n\n        img.onload = function () {\n          try {\n            canvas.width = result.orientation > 4 ? img.height : img.width;\n            canvas.height = result.orientation > 4 ? img.width : img.height;\n            var ctx = canvas.getContext('2d');\n            applyTransform(ctx, result.orientation, img.width, img.height);\n            ctx.drawImage(img, 0, 0);\n            var dataUrl = canvas.toDataURL(file.type || 'image/WebP', 0.934);\n            dataUrl = upload.restoreExif(arrayBufferToBase64(result.fixedArrayBuffer), dataUrl);\n            var blob = upload.dataUrltoBlob(dataUrl, file.name);\n            deferred.resolve(blob);\n          } catch (e) {\n            return deferred.reject(e);\n          }\n        };\n        img.onerror = function () {\n          deferred.reject();\n        };\n        img.src = url;\n      }, function (e) {\n        deferred.reject(e);\n      });\n    }, function (e) {\n      deferred.reject(e);\n    });\n    return deferred.promise;\n  };\n\n  upload.restoreExif = function (orig, resized) {\n    var ExifRestorer = {};\n\n    ExifRestorer.KEY_STR = 'ABCDEFGHIJKLMNOP' +\n      'QRSTUVWXYZabcdef' +\n      'ghijklmnopqrstuv' +\n      'wxyz0123456789+/' +\n      '=';\n\n    ExifRestorer.encode64 = function (input) {\n      var output = '',\n        chr1, chr2, chr3 = '',\n        enc1, enc2, enc3, enc4 = '',\n        i = 0;\n\n      do {\n        chr1 = input[i++];\n        chr2 = input[i++];\n        chr3 = input[i++];\n\n        enc1 = chr1 >> 2;\n        enc2 = ((chr1 & 3) << 4) | (chr2 >> 4);\n        enc3 = ((chr2 & 15) << 2) | (chr3 >> 6);\n        enc4 = chr3 & 63;\n\n        if (isNaN(chr2)) {\n          enc3 = enc4 = 64;\n        } else if (isNaN(chr3)) {\n          enc4 = 64;\n        }\n\n        output = output +\n          this.KEY_STR.charAt(enc1) +\n          this.KEY_STR.charAt(enc2) +\n          this.KEY_STR.charAt(enc3) +\n          this.KEY_STR.charAt(enc4);\n        chr1 = chr2 = chr3 = '';\n        enc1 = enc2 = enc3 = enc4 = '';\n      } while (i < input.length);\n\n      return output;\n    };\n\n    ExifRestorer.restore = function (origFileBase64, resizedFileBase64) {\n      if (origFileBase64.match('data:image/jpeg;base64,')) {\n        origFileBase64 = origFileBase64.replace('data:image/jpeg;base64,', '');\n      }\n\n      var rawImage = this.decode64(origFileBase64);\n      var segments = this.slice2Segments(rawImage);\n\n      var image = this.exifManipulation(resizedFileBase64, segments);\n\n      return 'data:image/jpeg;base64,' + this.encode64(image);\n    };\n\n\n    ExifRestorer.exifManipulation = function (resizedFileBase64, segments) {\n      var exifArray = this.getExifArray(segments),\n        newImageArray = this.insertExif(resizedFileBase64, exifArray);\n      return new Uint8Array(newImageArray);\n    };\n\n\n    ExifRestorer.getExifArray = function (segments) {\n      var seg;\n      for (var x = 0; x < segments.length; x++) {\n        seg = segments[x];\n        if (seg[0] === 255 & seg[1] === 225) //(ff e1)\n        {\n          return seg;\n        }\n      }\n      return [];\n    };\n\n\n    ExifRestorer.insertExif = function (resizedFileBase64, exifArray) {\n      var imageData = resizedFileBase64.replace('data:image/jpeg;base64,', ''),\n        buf = this.decode64(imageData),\n        separatePoint = buf.indexOf(255, 3),\n        mae = buf.slice(0, separatePoint),\n        ato = buf.slice(separatePoint),\n        array = mae;\n\n      array = array.concat(exifArray);\n      array = array.concat(ato);\n      return array;\n    };\n\n\n    ExifRestorer.slice2Segments = function (rawImageArray) {\n      var head = 0,\n        segments = [];\n\n      while (1) {\n        if (rawImageArray[head] === 255 & rawImageArray[head + 1] === 218) {\n          break;\n        }\n        if (rawImageArray[head] === 255 & rawImageArray[head + 1] === 216) {\n          head += 2;\n        }\n        else {\n          var length = rawImageArray[head + 2] * 256 + rawImageArray[head + 3],\n            endPoint = head + length + 2,\n            seg = rawImageArray.slice(head, endPoint);\n          segments.push(seg);\n          head = endPoint;\n        }\n        if (head > rawImageArray.length) {\n          break;\n        }\n      }\n\n      return segments;\n    };\n\n\n    ExifRestorer.decode64 = function (input) {\n      var chr1, chr2, chr3 = '',\n        enc1, enc2, enc3, enc4 = '',\n        i = 0,\n        buf = [];\n\n      // remove all characters that are not A-Z, a-z, 0-9, +, /, or =\n      var base64test = /[^A-Za-z0-9\\+\\/\\=]/g;\n      if (base64test.exec(input)) {\n        console.log('There were invalid base64 characters in the input text.\\n' +\n          'Valid base64 characters are A-Z, a-z, 0-9, ' + ', ' / ',and \"=\"\\n' +\n          'Expect errors in decoding.');\n      }\n      input = input.replace(/[^A-Za-z0-9\\+\\/\\=]/g, '');\n\n      do {\n        enc1 = this.KEY_STR.indexOf(input.charAt(i++));\n        enc2 = this.KEY_STR.indexOf(input.charAt(i++));\n        enc3 = this.KEY_STR.indexOf(input.charAt(i++));\n        enc4 = this.KEY_STR.indexOf(input.charAt(i++));\n\n        chr1 = (enc1 << 2) | (enc2 >> 4);\n        chr2 = ((enc2 & 15) << 4) | (enc3 >> 2);\n        chr3 = ((enc3 & 3) << 6) | enc4;\n\n        buf.push(chr1);\n\n        if (enc3 !== 64) {\n          buf.push(chr2);\n        }\n        if (enc4 !== 64) {\n          buf.push(chr3);\n        }\n\n        chr1 = chr2 = chr3 = '';\n        enc1 = enc2 = enc3 = enc4 = '';\n\n      } while (i < input.length);\n\n      return buf;\n    };\n\n    return ExifRestorer.restore(orig, resized);  //<= EXIF\n  };\n\n  return upload;\n}]);\n\n","/**!\n * AngularJS file upload directives and services. Supports: file upload/drop/paste, resume, cancel/abort,\n * progress, resize, thumbnail, preview, validation and CORS\n * FileAPI Flash shim for old browsers not supporting FormData\n * @author  Danial  <danial.farid@gmail.com>\n * @version 12.2.13\n */\n\n(function () {\n  /** @namespace FileAPI.noContentTimeout */\n\n  function patchXHR(fnName, newFn) {\n    window.XMLHttpRequest.prototype[fnName] = newFn(window.XMLHttpRequest.prototype[fnName]);\n  }\n\n  function redefineProp(xhr, prop, fn) {\n    try {\n      Object.defineProperty(xhr, prop, {get: fn});\n    } catch (e) {/*ignore*/\n    }\n  }\n\n  if (!window.FileAPI) {\n    window.FileAPI = {};\n  }\n\n  if (!window.XMLHttpRequest) {\n    throw 'AJAX is not supported. XMLHttpRequest is not defined.';\n  }\n\n  FileAPI.shouldLoad = !window.FormData || FileAPI.forceLoad;\n  if (FileAPI.shouldLoad) {\n    var initializeUploadListener = function (xhr) {\n      if (!xhr.__listeners) {\n        if (!xhr.upload) xhr.upload = {};\n        xhr.__listeners = [];\n        var origAddEventListener = xhr.upload.addEventListener;\n        xhr.upload.addEventListener = function (t, fn) {\n          xhr.__listeners[t] = fn;\n          if (origAddEventListener) origAddEventListener.apply(this, arguments);\n        };\n      }\n    };\n\n    patchXHR('open', function (orig) {\n      return function (m, url, b) {\n        initializeUploadListener(this);\n        this.__url = url;\n        try {\n          orig.apply(this, [m, url, b]);\n        } catch (e) {\n          if (e.message.indexOf('Access is denied') > -1) {\n            this.__origError = e;\n            orig.apply(this, [m, '_fix_for_ie_crossdomain__', b]);\n          }\n        }\n      };\n    });\n\n    patchXHR('getResponseHeader', function (orig) {\n      return function (h) {\n        return this.__fileApiXHR && this.__fileApiXHR.getResponseHeader ? this.__fileApiXHR.getResponseHeader(h) : (orig == null ? null : orig.apply(this, [h]));\n      };\n    });\n\n    patchXHR('getAllResponseHeaders', function (orig) {\n      return function () {\n        return this.__fileApiXHR && this.__fileApiXHR.getAllResponseHeaders ? this.__fileApiXHR.getAllResponseHeaders() : (orig == null ? null : orig.apply(this));\n      };\n    });\n\n    patchXHR('abort', function (orig) {\n      return function () {\n        return this.__fileApiXHR && this.__fileApiXHR.abort ? this.__fileApiXHR.abort() : (orig == null ? null : orig.apply(this));\n      };\n    });\n\n    patchXHR('setRequestHeader', function (orig) {\n      return function (header, value) {\n        if (header === '__setXHR_') {\n          initializeUploadListener(this);\n          var val = value(this);\n          // fix for angular < 1.2.0\n          if (val instanceof Function) {\n            val(this);\n          }\n        } else {\n          this.__requestHeaders = this.__requestHeaders || {};\n          this.__requestHeaders[header] = value;\n          orig.apply(this, arguments);\n        }\n      };\n    });\n\n    patchXHR('send', function (orig) {\n      return function () {\n        var xhr = this;\n        if (arguments[0] && arguments[0].__isFileAPIShim) {\n          var formData = arguments[0];\n          var config = {\n            url: xhr.__url,\n            jsonp: false, //removes the callback form param\n            cache: true, //removes the ?fileapiXXX in the url\n            complete: function (err, fileApiXHR) {\n              if (err && angular.isString(err) && err.indexOf('#2174') !== -1) {\n                // this error seems to be fine the file is being uploaded properly.\n                err = null;\n              }\n              xhr.__completed = true;\n              if (!err && xhr.__listeners.load)\n                xhr.__listeners.load({\n                  type: 'load',\n                  loaded: xhr.__loaded,\n                  total: xhr.__total,\n                  target: xhr,\n                  lengthComputable: true\n                });\n              if (!err && xhr.__listeners.loadend)\n                xhr.__listeners.loadend({\n                  type: 'loadend',\n                  loaded: xhr.__loaded,\n                  total: xhr.__total,\n                  target: xhr,\n                  lengthComputable: true\n                });\n              if (err === 'abort' && xhr.__listeners.abort)\n                xhr.__listeners.abort({\n                  type: 'abort',\n                  loaded: xhr.__loaded,\n                  total: xhr.__total,\n                  target: xhr,\n                  lengthComputable: true\n                });\n              if (fileApiXHR.status !== undefined) redefineProp(xhr, 'status', function () {\n                return (fileApiXHR.status === 0 && err && err !== 'abort') ? 500 : fileApiXHR.status;\n              });\n              if (fileApiXHR.statusText !== undefined) redefineProp(xhr, 'statusText', function () {\n                return fileApiXHR.statusText;\n              });\n              redefineProp(xhr, 'readyState', function () {\n                return 4;\n              });\n              if (fileApiXHR.response !== undefined) redefineProp(xhr, 'response', function () {\n                return fileApiXHR.response;\n              });\n              var resp = fileApiXHR.responseText || (err && fileApiXHR.status === 0 && err !== 'abort' ? err : undefined);\n              redefineProp(xhr, 'responseText', function () {\n                return resp;\n              });\n              redefineProp(xhr, 'response', function () {\n                return resp;\n              });\n              if (err) redefineProp(xhr, 'err', function () {\n                return err;\n              });\n              xhr.__fileApiXHR = fileApiXHR;\n              if (xhr.onreadystatechange) xhr.onreadystatechange();\n              if (xhr.onload) xhr.onload();\n            },\n            progress: function (e) {\n              e.target = xhr;\n              if (xhr.__listeners.progress) xhr.__listeners.progress(e);\n              xhr.__total = e.total;\n              xhr.__loaded = e.loaded;\n              if (e.total === e.loaded) {\n                // fix flash issue that doesn't call complete if there is no response text from the server\n                var _this = this;\n                setTimeout(function () {\n                  if (!xhr.__completed) {\n                    xhr.getAllResponseHeaders = function () {\n                    };\n                    _this.complete(null, {status: 204, statusText: 'No Content'});\n                  }\n                }, FileAPI.noContentTimeout || 10000);\n              }\n            },\n            headers: xhr.__requestHeaders\n          };\n          config.data = {};\n          config.files = {};\n          for (var i = 0; i < formData.data.length; i++) {\n            var item = formData.data[i];\n            if (item.val != null && item.val.name != null && item.val.size != null && item.val.type != null) {\n              config.files[item.key] = item.val;\n            } else {\n              config.data[item.key] = item.val;\n            }\n          }\n\n          setTimeout(function () {\n            if (!FileAPI.hasFlash) {\n              throw 'Adode Flash Player need to be installed. To check ahead use \"FileAPI.hasFlash\"';\n            }\n            xhr.__fileApiXHR = FileAPI.upload(config);\n          }, 1);\n        } else {\n          if (this.__origError) {\n            throw this.__origError;\n          }\n          orig.apply(xhr, arguments);\n        }\n      };\n    });\n    window.XMLHttpRequest.__isFileAPIShim = true;\n    window.FormData = FormData = function () {\n      return {\n        append: function (key, val, name) {\n          if (val.__isFileAPIBlobShim) {\n            val = val.data[0];\n          }\n          this.data.push({\n            key: key,\n            val: val,\n            name: name\n          });\n        },\n        data: [],\n        __isFileAPIShim: true\n      };\n    };\n\n    window.Blob = Blob = function (b) {\n      return {\n        data: b,\n        __isFileAPIBlobShim: true\n      };\n    };\n  }\n\n})();\n\n(function () {\n  /** @namespace FileAPI.forceLoad */\n  /** @namespace window.FileAPI.jsUrl */\n  /** @namespace window.FileAPI.jsPath */\n\n  function isInputTypeFile(elem) {\n    return elem[0].tagName.toLowerCase() === 'input' && elem.attr('type') && elem.attr('type').toLowerCase() === 'file';\n  }\n\n  function hasFlash() {\n    try {\n      var fo = new ActiveXObject('ShockwaveFlash.ShockwaveFlash');\n      if (fo) return true;\n    } catch (e) {\n      if (navigator.mimeTypes['application/x-shockwave-flash'] !== undefined) return true;\n    }\n    return false;\n  }\n\n  function getOffset(obj) {\n    var left = 0, top = 0;\n\n    if (window.jQuery) {\n      return jQuery(obj).offset();\n    }\n\n    if (obj.offsetParent) {\n      do {\n        left += (obj.offsetLeft - obj.scrollLeft);\n        top += (obj.offsetTop - obj.scrollTop);\n        obj = obj.offsetParent;\n      } while (obj);\n    }\n    return {\n      left: left,\n      top: top\n    };\n  }\n\n  if (FileAPI.shouldLoad) {\n    FileAPI.hasFlash = hasFlash();\n\n    //load FileAPI\n    if (FileAPI.forceLoad) {\n      FileAPI.html5 = false;\n    }\n\n    if (!FileAPI.upload) {\n      var jsUrl, basePath, script = document.createElement('script'), allScripts = document.getElementsByTagName('script'), i, index, src;\n      if (window.FileAPI.jsUrl) {\n        jsUrl = window.FileAPI.jsUrl;\n      } else if (window.FileAPI.jsPath) {\n        basePath = window.FileAPI.jsPath;\n      } else {\n        for (i = 0; i < allScripts.length; i++) {\n          src = allScripts[i].src;\n          index = src.search(/\\/ng\\-file\\-upload[\\-a-zA-z0-9\\.]*\\.js/);\n          if (index > -1) {\n            basePath = src.substring(0, index + 1);\n            break;\n          }\n        }\n      }\n\n      if (FileAPI.staticPath == null) FileAPI.staticPath = basePath;\n      script.setAttribute('src', jsUrl || basePath + 'FileAPI.min.js');\n      document.getElementsByTagName('head')[0].appendChild(script);\n    }\n\n    FileAPI.ngfFixIE = function (elem, fileElem, changeFn) {\n      if (!hasFlash()) {\n        throw 'Adode Flash Player need to be installed. To check ahead use \"FileAPI.hasFlash\"';\n      }\n      var fixInputStyle = function () {\n        var label = fileElem.parent();\n        if (elem.attr('disabled')) {\n          if (label) label.removeClass('js-fileapi-wrapper');\n        } else {\n          if (!fileElem.attr('__ngf_flash_')) {\n            fileElem.unbind('change');\n            fileElem.unbind('click');\n            fileElem.bind('change', function (evt) {\n              fileApiChangeFn.apply(this, [evt]);\n              changeFn.apply(this, [evt]);\n            });\n            fileElem.attr('__ngf_flash_', 'true');\n          }\n          label.addClass('js-fileapi-wrapper');\n          if (!isInputTypeFile(elem)) {\n            label.css('position', 'absolute')\n              .css('top', getOffset(elem[0]).top + 'px').css('left', getOffset(elem[0]).left + 'px')\n              .css('width', elem[0].offsetWidth + 'px').css('height', elem[0].offsetHeight + 'px')\n              .css('filter', 'alpha(opacity=0)').css('display', elem.css('display'))\n              .css('overflow', 'hidden').css('z-index', '900000')\n              .css('visibility', 'visible');\n            fileElem.css('width', elem[0].offsetWidth + 'px').css('height', elem[0].offsetHeight + 'px')\n              .css('position', 'absolute').css('top', '0px').css('left', '0px');\n          }\n        }\n      };\n\n      elem.bind('mouseenter', fixInputStyle);\n\n      var fileApiChangeFn = function (evt) {\n        var files = FileAPI.getFiles(evt);\n        //just a double check for #233\n        for (var i = 0; i < files.length; i++) {\n          if (files[i].size === undefined) files[i].size = 0;\n          if (files[i].name === undefined) files[i].name = 'file';\n          if (files[i].type === undefined) files[i].type = 'undefined';\n        }\n        if (!evt.target) {\n          evt.target = {};\n        }\n        evt.target.files = files;\n        // if evt.target.files is not writable use helper field\n        if (evt.target.files !== files) {\n          evt.__files_ = files;\n        }\n        (evt.__files_ || evt.target.files).item = function (i) {\n          return (evt.__files_ || evt.target.files)[i] || null;\n        };\n      };\n    };\n\n    FileAPI.disableFileInput = function (elem, disable) {\n      if (disable) {\n        elem.removeClass('js-fileapi-wrapper');\n      } else {\n        elem.addClass('js-fileapi-wrapper');\n      }\n    };\n  }\n})();\n\nif (!window.FileReader) {\n  window.FileReader = function () {\n    var _this = this, loadStarted = false;\n    this.listeners = {};\n    this.addEventListener = function (type, fn) {\n      _this.listeners[type] = _this.listeners[type] || [];\n      _this.listeners[type].push(fn);\n    };\n    this.removeEventListener = function (type, fn) {\n      if (_this.listeners[type]) _this.listeners[type].splice(_this.listeners[type].indexOf(fn), 1);\n    };\n    this.dispatchEvent = function (evt) {\n      var list = _this.listeners[evt.type];\n      if (list) {\n        for (var i = 0; i < list.length; i++) {\n          list[i].call(_this, evt);\n        }\n      }\n    };\n    this.onabort = this.onerror = this.onload = this.onloadstart = this.onloadend = this.onprogress = null;\n\n    var constructEvent = function (type, evt) {\n      var e = {type: type, target: _this, loaded: evt.loaded, total: evt.total, error: evt.error};\n      if (evt.result != null) e.target.result = evt.result;\n      return e;\n    };\n    var listener = function (evt) {\n      if (!loadStarted) {\n        loadStarted = true;\n        if (_this.onloadstart) _this.onloadstart(constructEvent('loadstart', evt));\n      }\n      var e;\n      if (evt.type === 'load') {\n        if (_this.onloadend) _this.onloadend(constructEvent('loadend', evt));\n        e = constructEvent('load', evt);\n        if (_this.onload) _this.onload(e);\n        _this.dispatchEvent(e);\n      } else if (evt.type === 'progress') {\n        e = constructEvent('progress', evt);\n        if (_this.onprogress) _this.onprogress(e);\n        _this.dispatchEvent(e);\n      } else {\n        e = constructEvent('error', evt);\n        if (_this.onerror) _this.onerror(e);\n        _this.dispatchEvent(e);\n      }\n    };\n    this.readAsDataURL = function (file) {\n      FileAPI.readAsDataURL(file, listener);\n    };\n    this.readAsText = function (file) {\n      FileAPI.readAsText(file, listener);\n    };\n  };\n}\n"],"sourceRoot":"assets/scripts/"}