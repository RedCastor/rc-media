!function(e,t){"use strict";function n(e){if(!("clientX"in e||"clientY"in e)){var t=e.touches||e.originalEvent.touches;t&&t.length&&(e.clientX=t[0].clientX,e.clientY=t[0].clientY),e.preventDefault()}}function o(e){if((e=e[0]).previousElementSibling)return t.element(e.previousElementSibling);for(var n=e.previousSibling;null!=n&&1!=n.nodeType;)n=n.previousSibling;return t.element(n)}function r(e,t){var n=o(e);n.length>0?n.after(t):e.parent().prepend(t)}function i(e,n){if(e instanceof t.element&&(e=e[0]),null!==c)return e[c](n)}var l=t.module("angular-sortable-view",[]);l.directive("svRoot",[function(){function e(e,t,n){return n?e.x-t.x<0:e.y-t.y<0}function t(e){return l[e]}function n(e){delete l[e]}var o,l=Object.create(null);return{restrict:"A",controller:["$scope","$attrs","$interpolate","$parse",function(s,c,a,d){var u=a(c.svRoot)(s)||s.$id;l[u]||(l[u]=[]);var p,m,h,v,f,g,$=!1,y=d(c.svOnSort);c.svOnStart=c.$$element[0].attributes["sv-on-start"],c.svOnStart=c.svOnStart&&c.svOnStart.value,c.svOnStop=c.$$element[0].attributes["sv-on-stop"],c.svOnStop=c.svOnStop&&c.svOnStop.value;var x=d(c.svOnStart),w=d(c.svOnStop);if(this.sortingInProgress=function(){return o},c.svGrid){if(null===($="true"===c.svGrid||"false"!==c.svGrid&&null))throw"Invalid value of sv-grid attribute"}else s.$watchCollection(function(){return t(u)},function(e){$=!1;var t=e.filter(function(e){return!e.container}).map(function(e){return{part:e.getPart().id,y:e.element[0].getBoundingClientRect().top}}),n=Object.create(null);t.forEach(function(e){n[e.part]?n[e.part].push(e.y):n[e.part]=[e.y]}),Object.keys(n).forEach(function(e){n[e].sort(),n[e].forEach(function(t,o){o<n[e].length-1&&t>0&&t===n[e][o+1]&&($=!0)})})});this.$moveUpdate=function(n,l,c,a,d,y,w){var b=c[0].getBoundingClientRect();"element"===n.tolerance&&(l={x:~~(b.left+b.width/2),y:~~(b.top+b.height/2)}),o=!0,p=[],m||(d?(m=d.clone()).removeClass("ng-hide"):((m=a.clone()).addClass("sv-visibility-hidden"),m.addClass("sv-placeholder"),m.css({height:b.height+"px",width:b.width+"px"})),a.after(m),a.addClass("ng-hide"),f=a,h=n,x(s,{$helper:{element:v=c},$part:y.model(y.scope),$index:w,$item:y.model(y.scope)[w]}),s.$root&&s.$root.$$phase||s.$apply()),v[0].reposition({x:l.x+document.body.scrollLeft-l.offset.x*b.width,y:l.y+document.body.scrollTop-l.offset.y*b.height}),t(u).forEach(function(t,o){if(null==n.containment||i(t.element,n.containment)||i(t.element,n.containment+" *")){var r=t.element[0].getBoundingClientRect(),s={x:~~(r.left+r.width/2),y:~~(r.top+r.height/2)};t.container||!t.element[0].scrollHeight&&!t.element[0].scrollWidth||p.push({element:t.element,q:(s.x-l.x)*(s.x-l.x)+(s.y-l.y)*(s.y-l.y),view:t.getPart(),targetIndex:t.getIndex(),after:e(s,l,$)}),t.container&&!t.element[0].querySelector("[sv-element]:not(.sv-placeholder):not(.sv-source)")&&p.push({element:t.element,q:(s.x-l.x)*(s.x-l.x)+(s.y-l.y)*(s.y-l.y),view:t.getPart(),targetIndex:0,container:!0})}});var S=m[0].getBoundingClientRect(),C={x:~~(S.left+S.width/2),y:~~(S.top+S.height/2)};p.push({q:(C.x-l.x)*(C.x-l.x)+(C.y-l.y)*(C.y-l.y),element:m,placeholder:!0}),p.sort(function(e,t){return e.q-t.q}),p.forEach(function(e,t){0!==t||e.placeholder||e.container?0===t&&e.container?(g=e,e.element.append(m)):e.element.removeClass("sv-candidate"):(g=e,e.element.addClass("sv-candidate"),e.after?e.element.after(m):r(e.element,m))})},this.$drop=function(e,t,n){function r(){if(o=!1,m.remove(),v.remove(),f.removeClass("ng-hide"),p=void 0,m=void 0,n=void 0,v=void 0,f=void 0,w(s,{$part:e.model(e.scope),$index:t,$item:e.model(e.scope)[t]}),g){g.element.removeClass("sv-candidate");var r=e.model(e.scope).splice(t,1),i=g.targetIndex;g.view===e&&g.targetIndex>t&&i--,g.after&&i++,g.view.model(g.view.scope).splice(i,0,r[0]),g.view===e&&t===i||y(s,{$partTo:g.view.model(g.view.scope),$partFrom:e.model(e.scope),$item:r[0],$indexTo:i,$indexFrom:t})}g=void 0,s.$root&&s.$root.$$phase||s.$apply()}if(m)if(n.revert){var i=m[0].getBoundingClientRect(),l=v[0].getBoundingClientRect(),c=Math.sqrt(Math.pow(l.top-i.top,2)+Math.pow(l.left-i.left,2)),a=+n.revert*c/200;a=Math.min(a,+n.revert),["-webkit-","-moz-","-ms-","-o-",""].forEach(function(e){void 0!==v[0].style[e+"transition"]&&(v[0].style[e+"transition"]="all "+a+"ms ease")}),setTimeout(r,a),v.css({top:i.top+document.body.scrollTop+"px",left:i.left+document.body.scrollLeft+"px"})}else r()},this.addToSortableElements=function(e){t(u).push(e)},this.removeFromSortableElements=function(e){var o=t(u),r=o.indexOf(e);r>-1&&(o.splice(r,1),0===o.length&&n(u))}}]}}]),l.directive("svPart",["$parse",function(e){return{restrict:"A",require:"^svRoot",controller:["$scope",function(e){e.$ctrl=this,this.getPart=function(){return e.part},this.$drop=function(t,n){e.$sortableRoot.$drop(e.part,t,n)}}],scope:!0,link:function(t,n,o,r){if(!o.svPart)throw new Error("no model provided");var i=e(o.svPart);if(!i.assign)throw new Error("model not assignable");t.part={id:t.$id,element:n,model:i,scope:t},t.$sortableRoot=r;var l={element:n,getPart:t.$ctrl.getPart,container:!0};r.addToSortableElements(l),t.$on("$destroy",function(){r.removeFromSortableElements(l)})}}}]),l.directive("svElement",["$parse",function(e){return{restrict:"A",require:["^svPart","^svRoot"],controller:["$scope",function(e){e.$ctrl=this}],link:function(o,r,i,l){function s(s){function c(e){n(e),m||(r.parent().prepend(f),m=!0),l[1].$moveUpdate(d,{x:e.clientX,y:e.clientY,offset:y},f,r,p,l[0].getPart(),o.$index)}if(n(s),!l[1].sortingInProgress()&&(0==s.button||"mousedown"!==s.type)){m=!1;var d=e(i.svElement)(o);if((d=t.extend({},{tolerance:"pointer",revert:200,containment:"html"},d)).containment)var v=a.call(r,d.containment)[0].getBoundingClientRect();var f,g=r,$=r[0].getBoundingClientRect();u||(u=l[0].helper),p||(p=l[0].placeholder),u?((f=u.clone()).removeClass("ng-hide"),f.css({left:$.left+document.body.scrollLeft+"px",top:$.top+document.body.scrollTop+"px"}),g.addClass("sv-visibility-hidden")):(f=g.clone()).addClass("sv-helper").css({left:$.left+document.body.scrollLeft+"px",top:$.top+document.body.scrollTop+"px",width:$.width+"px"}),f[0].reposition=function(e){var t=e.x,n=e.y,o=f[0].getBoundingClientRect(),r=document.body;v&&(n<v.top+r.scrollTop&&(n=v.top+r.scrollTop),n+o.height>v.top+r.scrollTop+v.height&&(n=v.top+r.scrollTop+v.height-o.height),t<v.left+r.scrollLeft&&(t=v.left+r.scrollLeft),t+o.width>v.left+r.scrollLeft+v.width&&(t=v.left+r.scrollLeft+v.width-o.width)),this.style.left=t-r.scrollLeft+"px",this.style.top=n-r.scrollTop+"px"};var y={x:(s.clientX-$.left)/$.width,y:(s.clientY-$.top)/$.height};h.addClass("sv-sorting-in-progress"),h.on("mousemove touchmove",c).on("mouseup touchend touchcancel",function e(t){h.off("mousemove touchmove",c),h.off("mouseup touchend",e),h.removeClass("sv-sorting-in-progress"),m&&l[0].$drop(o.$index,d),r.removeClass("sv-visibility-hidden")})}}var c={element:r,getPart:l[0].getPart,getIndex:function(){return o.$index}};l[1].addToSortableElements(c),o.$on("$destroy",function(){l[1].removeFromSortableElements(c)});var d=r;d.on("mousedown touchstart",s),o.$watch("$ctrl.handle",function(e){e&&(d.off("mousedown touchstart",s),(d=e).on("mousedown touchstart",s))});var u;o.$watch("$ctrl.helper",function(e){e&&(u=e)});var p;o.$watch("$ctrl.placeholder",function(e){e&&(p=e)});t.element(document.body);var m,h=t.element(document.documentElement)}}}]),l.directive("svHandle",function(){return{require:"?^svElement",link:function(e,t,n,o){o&&(o.handle=t.add(o.handle))}}}),l.directive("svHelper",function(){return{require:["?^svPart","?^svElement"],link:function(e,t,n,o){t.addClass("sv-helper").addClass("ng-hide"),o[1]?o[1].helper=t:o[0]&&(o[0].helper=t)}}}),l.directive("svPlaceholder",function(){return{require:["?^svPart","?^svElement"],link:function(e,t,n,o){t.addClass("sv-placeholder").addClass("ng-hide"),o[1]?o[1].placeholder=t:o[0]&&(o[0].placeholder=t)}}}),t.element(document.head).append(["<style>.sv-helper{position: fixed !important;z-index: 99999;margin: 0 !important;}.sv-candidate{}.sv-placeholder{}.sv-sorting-in-progress{-webkit-user-select: none;-moz-user-select: none;-ms-user-select: none;user-select: none;}.sv-visibility-hidden{visibility: hidden !important;opacity: 0 !important;}</style>"].join(""));var s=document.documentElement,c=s.matches?"matches":s.matchesSelector?"matchesSelector":s.webkitMatches?"webkitMatches":s.webkitMatchesSelector?"webkitMatchesSelector":s.msMatches?"msMatches":s.msMatchesSelector?"msMatchesSelector":s.mozMatches?"mozMatches":s.mozMatchesSelector?"mozMatchesSelector":null;if(null==c)throw"This browser doesn't support the HTMLElement.matches method";var a=t.element.prototype.closest||function(e){for(var n=this[0].parentNode;n!==document.documentElement&&!n[c](e);)n=n.parentNode;return n[c](e)?t.element(n):t.element()};"function"!=typeof t.element.prototype.add&&(t.element.prototype.add=function(e){var n,o=t.element();for(e=t.element(e),n=0;n<this.length;n++)o.push(this[n]);for(n=0;n<e.length;n++)o.push(e[n]);return o})}(window,window.angular);
//# sourceMappingURL=angular-sortable-view.js.map
